<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>非淡泊无以明志，非宁静无以致远。 on 非淡泊无以明志，非宁静无以致远。</title>
    <link>/</link>
    <description>Recent content in 非淡泊无以明志，非宁静无以致远。 on 非淡泊无以明志，非宁静无以致远。</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2017 Sheng Luan</copyright>
    <lastBuildDate>Wed, 20 Apr 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Rgraphviz 学习笔记</title>
      <link>/post/rgraphviz-note1/</link>
      <pubDate>Mon, 22 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/rgraphviz-note1/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.graphviz.org/&#34;&gt;graphviz&lt;/a&gt; (Graph Visualization Software)是贝尔实验室鼓捣出来的一个用来展示结构化信息的软件。有一个对应的Rgraphviz包，学习一下，这是一个用来画系谱图的好工具。&lt;/p&gt;
&lt;p&gt;Rgraphviz包现在已经被收录到&lt;a href=&#34;http://www.bioconductor.org/&#34;&gt;Bioconductor&lt;/a&gt;平台，不在cran中，因此正常的安装包的流程无法获取该包。需要根据Bioconductor的&lt;a href=&#34;http://www.bioconductor.org/packages/release/bioc/html/Rgraphviz.html&#34;&gt;安装指令&lt;/a&gt;进行安装：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;source(&amp;quot;https://bioconductor.org/biocLite.R&amp;quot;)
biocLite(&amp;quot;Rgraphviz&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;graphviz&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. Graphviz的简单说明&lt;/h2&gt;
&lt;p&gt;这个软件包可以生成各种图像格式的文件，以及SVG文件，可以用于web网络展示；也可以生成PDF文件。&lt;/p&gt;
&lt;p&gt;graphviz 中国包括了很多布局器：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dot 默认的布局方式，主要是用于有向图。（画系谱，这应该是一个主要布局方式）&lt;/li&gt;
&lt;li&gt;neato 基于spring-model（又称force-based）算法&lt;/li&gt;
&lt;li&gt;twopi 径向布局&lt;/li&gt;
&lt;li&gt;circo 圆环布局&lt;/li&gt;
&lt;li&gt;fdp 无向图&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;graphviz默认使用一种dot语言来定义图形元素，然后选择上边的布局算法进行布局，最后生成结果。&lt;/p&gt;
&lt;p&gt;大体步骤如下： 1. 利用dot脚本，定义一个图，然后向图中，添加节点和边。 2. 定义节点和边各自的属性，比如形状、颜色、填充模式、字体等。 2. 使用布局引擎，调用布局算法，绘制图形。&lt;/p&gt;
&lt;p&gt;graphviz中三个基本的元素：图（graph）、节点（node）和边（edge） 参考一篇&lt;a href=&#34;http://icodeit.org/2015/11/using-graphviz-drawing/&#34;&gt;blog&lt;/a&gt;，关于graphviz的入门说明。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;graphviz&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;2. 初窥Graphviz&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;knitr::opts_chunk$set(echo = TRUE,fig.align = &amp;quot;center&amp;quot;)
suppressPackageStartupMessages(require(Rgraphviz))&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;set.seed(123)
v &amp;lt;- letters[1:10] #储存节点
m &amp;lt;- 1:4 #
g1 &amp;lt;- randomGraph(v,m,0.2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;不同的布局样式，默认是有向图。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(g1)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:dot&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/dot-1.png&#34; alt=&#34;默认的有向图(dot)&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: 默认的有向图(dot)
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;第二种布局：neato&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(g1, &amp;quot;neato&amp;quot; )&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:neato&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/neato-1.png&#34; alt=&#34;第二种布局(neato)&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: 第二种布局(neato)
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;第三种布局，twopi：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(g1, &amp;quot;twopi&amp;quot; )&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:twopi&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/twopi-1.png&#34; alt=&#34;第三种布局(twopi)&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 3: 第三种布局(twopi)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;3. 从头开始画一个图&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#定义节点
nodes &amp;lt;- c(&amp;quot;A&amp;quot;,&amp;quot;B&amp;quot;,&amp;quot;C&amp;quot;,&amp;quot;D&amp;quot;,&amp;quot;E&amp;quot;,&amp;quot;F&amp;quot;,&amp;quot;G&amp;quot;)
#生成一个简单的系谱图
rEG &amp;lt;- new(&amp;quot;graphNEL&amp;quot;,nodes=nodes,edgemode=&amp;quot;directed&amp;quot;)
rEG &amp;lt;- addEdge(from=&amp;quot;A&amp;quot;,to = &amp;quot;B&amp;quot;,graph = rEG,weights = 1)
rEG &amp;lt;- addEdge(from=&amp;quot;A&amp;quot;,to = &amp;quot;C&amp;quot;,graph = rEG,weights = 2)
rEG &amp;lt;- addEdge(from=&amp;quot;B&amp;quot;,to = &amp;quot;D&amp;quot;,graph = rEG,weights = 3)
rEG &amp;lt;- addEdge(from=&amp;quot;B&amp;quot;,to = &amp;quot;E&amp;quot;,graph = rEG,weights = 10)
rEG &amp;lt;- addEdge(from=&amp;quot;C&amp;quot;,to = &amp;quot;F&amp;quot;,graph = rEG,weights = 3)
rEG &amp;lt;- addEdge(from=&amp;quot;C&amp;quot;,to = &amp;quot;G&amp;quot;,graph = rEG,weights = 10)
#从上望下画
plot(rEG,attrs=list(graph=list(rankdir=&amp;quot;TB&amp;quot;)))  #TB from top to bottom&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:simple&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/simple-1.png&#34; alt=&#34;最简单的图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 4: 最简单的图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;从下往上画，更符合系谱图的惯例&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(rEG,attrs=list(graph=list(rankdir=&amp;quot;BT&amp;quot;))) #BT from bottom to top&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/draworder-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;4. 调整节点的颜色&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(rEG,attrs=list(node=list(color=&amp;quot;deepskyblue4&amp;quot;,fontcolor=&amp;quot;orange&amp;quot;,fillcolor=&amp;quot;deepskyblue4&amp;quot;),graph=list(rankdir=&amp;quot;BT&amp;quot;))) #BT from bottom to top&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/nodecolor-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;5. 调整节点的形状&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(rEG,attrs=list(node=list(shape=&amp;quot;ellipse&amp;quot;,color=&amp;quot;deepskyblue4&amp;quot;,fontcolor=&amp;quot;orange&amp;quot;,fillcolor=&amp;quot;deepskyblue4&amp;quot;),graph=list(rankdir=&amp;quot;BT&amp;quot;))) #BT from bottom to top&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/nodeshape-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;6. 调整边的颜色&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(rEG,attrs=list(node=list(color=&amp;quot;deepskyblue4&amp;quot;,fontcolor=&amp;quot;orange&amp;quot;,fillcolor=&amp;quot;deepskyblue4&amp;quot;),edge=list(color=&amp;quot;deepskyblue4&amp;quot;),graph=list(rankdir=&amp;quot;BT&amp;quot;))) #BT from bottom to top&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-01-22-rgraphviz-note1_files/figure-html/edge-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;```&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>字符串处理包stringr学习笔记-1</title>
      <link>/post/stringr-note-1/</link>
      <pubDate>Thu, 11 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/stringr-note-1/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;


&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;suppressPackageStartupMessages(require(stringr))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;R中的字符串处理函数，不但多，而且难记，参数调用方法也不一致。stringr包提供了统一名称的函数调用形式。&lt;/p&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. 基本处理&lt;/h2&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.1 计算字符串的长度&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_length(&amp;quot;abc&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 3&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_length(&amp;quot;你好&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_length(NA)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] NA&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_length(c(&amp;quot;abc&amp;quot;,&amp;quot;ad&amp;quot;,&amp;quot;co&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 3 2 2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;str_length&lt;/code&gt;等同于R中自带的&lt;code&gt;nchar()&lt;/code&gt;函数可以正确的识别中文字的个数，赞一个。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.2 提取子字符串&lt;/h3&gt;
&lt;p&gt;下述函数可以针对向量操作，提取子字符串&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;-  c(&amp;quot;abcdefgh&amp;quot;,&amp;quot;dljwowowjj&amp;quot;)
str_sub(x,2,4) #从第2个位置到第四个位置&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;bcd&amp;quot; &amp;quot;ljw&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_sub(x,2,-2) #第二个位置到倒数第二个位置&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;bcdefg&amp;quot;   &amp;quot;ljwowowj&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.3 修改字符串中指定位置的内容&lt;/h3&gt;
&lt;p&gt;修改字符串中某个位置的字符&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_sub(x,3,5) &amp;lt;- &amp;quot;XYZ&amp;quot;
x&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;abXYZfgh&amp;quot;   &amp;quot;dlXYZwowjj&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.4 重复字符串的内容&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_dup(x,3) #表示每个字符串重复两次&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;abXYZfghabXYZfghabXYZfgh&amp;quot;       &amp;quot;dlXYZwowjjdlXYZwowjjdlXYZwowjj&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_dup(x,c(2,3)) #表示第一个字符串重复2次，第二个字符串重复3次&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;abXYZfghabXYZfgh&amp;quot;               &amp;quot;dlXYZwowjjdlXYZwowjjdlXYZwowjj&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.5 填补字符串至一定长度&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_pad(x,str_length(x[2])) #把第一个字符串用空格补充至跟第二字符串一样长&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;  abXYZfgh&amp;quot; &amp;quot;dlXYZwowjj&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_pad(string = x,width = str_length(x[2]),side = &amp;quot;right&amp;quot;, pad = &amp;quot;?&amp;quot;) #一个标准写法，用？号补充，在填补在右边&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;abXYZfgh??&amp;quot; &amp;quot;dlXYZwowjj&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;缩写字符串&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_trunc(x,3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;...&amp;quot; &amp;quot;...&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;默认的最小缩写字符串长度就是3（“…”），因此直接显示为“…”。&lt;/p&gt;
&lt;p&gt;如果想缩写为2位，可以这样写：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_trunc(x,2,ellipsis = &amp;quot;.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;a.&amp;quot; &amp;quot;d.&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.6 剔除字符串中的空格&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- c(&amp;quot;  a   &amp;quot;, &amp;quot;b   &amp;quot;,  &amp;quot;   c&amp;quot;)
str_trim(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.7 大小写转换+本地语言支持&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- &amp;quot;You are beautiful.&amp;quot;
str_to_lower(x) #转换为小写&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;you are beautiful.&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_to_upper(x) #转换为大写&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;YOU ARE BEAUTIFUL.&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_to_title(x) #首字母大写&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;You Are Beautiful.&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- &amp;quot;i love you&amp;quot;
str_to_upper(x,locale = &amp;quot;tr&amp;quot;) #土耳其语,i带点&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;&amp;lt;U+0130&amp;gt; LOVE YOU&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#stringi::stri_locale_list() #语言支持列表&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.8 排名和排序&lt;/h3&gt;
&lt;p&gt;获得每个元素的排名&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- c(&amp;quot;a&amp;quot;,&amp;quot;y&amp;quot;,&amp;quot;i&amp;quot;,&amp;quot;o&amp;quot;)
str_order(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 3 4 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;y &amp;lt;- c(&amp;quot;ac&amp;quot;,&amp;quot;oa&amp;quot;,&amp;quot;bp&amp;quot;,&amp;quot;oo&amp;quot;)
str_order(y)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 3 2 4&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;对y中的元素进行排序&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_sort(y)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;ac&amp;quot; &amp;quot;bp&amp;quot; &amp;quot;oa&amp;quot; &amp;quot;oo&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#另外一种实现方式
y[str_order(y)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;ac&amp;quot; &amp;quot;bp&amp;quot; &amp;quot;oa&amp;quot; &amp;quot;oo&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;降序排列&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_sort(x=y,decreasing = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;oo&amp;quot; &amp;quot;oa&amp;quot; &amp;quot;bp&amp;quot; &amp;quot;ac&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;字符类型的数字，支持按照数字大小排序&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- as.character(c(sample(1:100,5),1000))
x&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;92&amp;quot;   &amp;quot;55&amp;quot;   &amp;quot;83&amp;quot;   &amp;quot;61&amp;quot;   &amp;quot;74&amp;quot;   &amp;quot;1000&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_sort(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;1000&amp;quot; &amp;quot;55&amp;quot;   &amp;quot;61&amp;quot;   &amp;quot;74&amp;quot;   &amp;quot;83&amp;quot;   &amp;quot;92&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_sort(x,numeric =TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;55&amp;quot;   &amp;quot;61&amp;quot;   &amp;quot;74&amp;quot;   &amp;quot;83&amp;quot;   &amp;quot;92&amp;quot;   &amp;quot;1000&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.9 合并字符串&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_c(&amp;quot;I&amp;quot;,&amp;quot;love&amp;quot;,&amp;quot;this&amp;quot;,&amp;quot;world!&amp;quot;,sep = &amp;quot; &amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;I love this world!&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_c(c(&amp;quot;2018&amp;quot;,&amp;quot;01&amp;quot;,&amp;quot;18&amp;quot;),collapse = &amp;quot;-&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2018-01-18&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;2 模式匹配&lt;/h2&gt;
&lt;div id=&#34;-regular-expression&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;2.1 正则表达 regular expression&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;str_view()&lt;/code&gt;和&lt;code&gt;str_view_all()&lt;/code&gt;用来展示正则表达式是如何匹配的，是学习正则表达式的好帮手。&lt;/p&gt;
&lt;div class=&#34;section level4&#34;&gt;
&lt;h4&gt;2.1.1 基础匹配&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- c(&amp;quot;apple&amp;quot;, &amp;quot;banana&amp;quot;, &amp;quot;pear&amp;quot;)
str_view(x, &amp;quot;an&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;apple&lt;\/li&gt;\n  &lt;li&gt;b&lt;span class=&#39;match&#39;&gt;an&lt;\/span&gt;ana&lt;\/li&gt;\n  &lt;li&gt;pear&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;接下来会稍微复杂一些，加入通配符&lt;code&gt;.&lt;/code&gt;，匹配任何字符：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(x,&amp;quot;.a.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-2&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-2&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;apple&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;ban&lt;\/span&gt;ana&lt;\/li&gt;\n  &lt;li&gt;p&lt;span class=&#39;match&#39;&gt;ear&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;但是如何匹配字符串中的&lt;code&gt;.&lt;/code&gt;呢？我们需要一个逃脱符，也就是反斜杠&lt;code&gt;\&lt;/code&gt;，英文是blackflash，&lt;code&gt;\.&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;但是这里有一个问题，那就是在普通字符串处理中，R也定义了&lt;code&gt;\&lt;/code&gt;是一个逃脱符，而正则表达式又是通过字符串表达出来的，因此，为了匹配&lt;code&gt;.&lt;/code&gt;，需要写为&lt;code&gt;\\.&lt;/code&gt;。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;writeLines(&amp;quot;\\.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## \.&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(&amp;quot;b.a&amp;quot;,&amp;quot;\\.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-3&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-3&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;b&lt;span class=&#39;match&#39;&gt;.&lt;\/span&gt;a&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;那么另外一个问题是，如何匹配文字&lt;code&gt;\&lt;/code&gt;。根据规则，应该是&lt;code&gt;\\&lt;/code&gt;。但是，要想在R中输出&lt;code&gt;\\&lt;/code&gt;字符串（两个反斜杠），我们每个前边都需要再加一个反斜杠，这就变成了四个反斜杠&lt;code&gt;\\\\&lt;/code&gt;。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;writeLines(&amp;quot;\\\\&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## \\&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(&amp;quot;a\\b&amp;quot;,&amp;quot;\\\\&amp;quot;) &lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-4&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-4&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;a&lt;span class=&#39;match&#39;&gt;\\&lt;\/span&gt;b&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;/div&gt;
&lt;div class=&#34;section level4&#34;&gt;
&lt;h4&gt;2.1.2 引导符&lt;/h4&gt;
&lt;p&gt;如何匹配开头或者结尾字符。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;^&lt;/code&gt;用于匹配开头。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$&lt;/code&gt;用于匹配结尾。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- c(&amp;quot;apple&amp;quot;, &amp;quot;banana&amp;quot;, &amp;quot;pear&amp;quot;)
str_view(x, &amp;quot;^a&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-5&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-5&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;pple&lt;\/li&gt;\n  &lt;li&gt;banana&lt;\/li&gt;\n  &lt;li&gt;pear&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(x,&amp;quot;a$&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-6&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-6&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;apple&lt;\/li&gt;\n  &lt;li&gt;banan&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;pear&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(x,&amp;quot;^pear$&amp;quot;) #匹配完整字符串&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div id=&#34;htmlwidget-7&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-7&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;apple&lt;\/li&gt;\n  &lt;li&gt;banana&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;pear&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt; 如何匹配文字&lt;code&gt;$^$&lt;/code&gt;？&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(&amp;quot;$^$&amp;quot;,&amp;quot;\\$\\^\\$&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-8&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-8&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;$^$&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;一个小练习题，从&lt;code&gt;stringr::words&lt;/code&gt;900多个单词中找出首字母是y的所有单词：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(stringr::words,&amp;quot;^y&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div id=&#34;htmlwidget-9&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-9&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;y&lt;\/span&gt;ear&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;y&lt;\/span&gt;es&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;y&lt;\/span&gt;esterday&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;y&lt;\/span&gt;et&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;y&lt;\/span&gt;ou&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;y&lt;\/span&gt;oung&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt; 结尾是x的所有单词：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(stringr::words,&amp;quot;x$&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-10&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-10&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;bo&lt;span class=&#39;match&#39;&gt;x&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;se&lt;span class=&#39;match&#39;&gt;x&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;si&lt;span class=&#39;match&#39;&gt;x&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;ta&lt;span class=&#39;match&#39;&gt;x&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;列出长度为11的所有单词：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(stringr::words,&amp;quot;^.{11}$&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-11&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-11&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;appropriate&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;environment&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;opportunity&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;responsible&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;/div&gt;
&lt;div class=&#34;section level4&#34;&gt;
&lt;h4&gt;2.1.2 匹配不同类型的字符&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;.&lt;/code&gt;匹配任何字符，其他类型的字符包括： * &lt;code&gt;\d&lt;/code&gt;匹配任何数字 * &lt;code&gt;\s&lt;/code&gt;匹配空格、制表符、换行符 * &lt;code&gt;[abc]&lt;/code&gt;匹配abc中的任一个字符 * &lt;code&gt;[^abc]&lt;/code&gt; 匹配除了abc以外的任一个字符&lt;/p&gt;
&lt;p&gt;小小练习题。&lt;/p&gt;
&lt;p&gt;查找元音字母打头的单词&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(stringr::words,&amp;quot;^[aeiou]&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-12&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-12&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ble&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;bout&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;bsolute&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ccept&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ccount&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;chieve&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;cross&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ct&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ctive&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ctual&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;dd&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ddress&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;dmit&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;dvertise&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ffect&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;fford&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;fter&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;fternoon&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;gain&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;gainst&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ge&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;gent&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;go&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;gree&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ir&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ll&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;llow&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;lmost&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;long&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;lready&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;lright&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;lso&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;lthough&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;lways&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;merica&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;mount&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;nd&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;nother&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;nswer&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ny&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;part&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;pparent&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ppear&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;pply&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ppoint&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;pproach&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ppropriate&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;rea&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;rgue&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;rm&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;round&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;rrange&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;rt&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;s&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;sk&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ssociate&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ssume&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;t&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ttend&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;uthority&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;vailable&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;ware&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;way&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;wful&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ach&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;arly&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ast&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;asy&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;at&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;conomy&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ducate&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ffect&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;gg&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ight&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ither&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;lect&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;lectric&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;leven&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;lse&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;mploy&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ncourage&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;nd&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ngine&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;nglish&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;njoy&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;nough&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;nter&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;nvironment&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;qual&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;special&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;urope&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ven&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;vening&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ver&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;very&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;vidence&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xact&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xample&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xcept&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xcuse&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xercise&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xist&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xpect&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xpense&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xperience&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xplain&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xpress&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;xtra&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt;ye&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;dea&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;dentify&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;f&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;magine&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;mportant&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;mprove&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;n&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nclude&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ncome&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ncrease&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ndeed&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ndividual&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ndustry&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nform&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nside&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nstead&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nsure&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nterest&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nto&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ntroduce&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nvest&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;nvolve&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;ssue&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;t&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;i&lt;\/span&gt;tem&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;bvious&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ccasion&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;dd&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;f&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ff&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ffer&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ffice&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ften&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;kay&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ld&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;n&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;nce&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ne&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;nly&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;pen&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;perate&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;pportunity&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ppose&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;r&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;rder&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;rganize&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;riginal&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ther&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;therwise&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ught&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ut&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;ver&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;o&lt;\/span&gt;wn&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;nder&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;nderstand&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;nion&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;nit&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;nite&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;niversity&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;nless&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;ntil&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;p&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;pon&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;se&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;u&lt;\/span&gt;sual&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;那些单词结尾是“ed”但不是“eed”的单词：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(stringr::words,&amp;quot;[^e]ed$&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-13&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-13&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;bed&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;hund&lt;span class=&#39;match&#39;&gt;red&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;red&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;筛选出结尾是ing或者ise的单词&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(stringr::words,&amp;quot;ing|ise$&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-14&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-14&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;advert&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;br&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;dur&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;even&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;exerc&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;k&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;mean&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;morn&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;otherw&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;pract&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;ra&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;real&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;r&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;r&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;s&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;s&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;le&lt;\/li&gt;\n  &lt;li&gt;surpr&lt;span class=&#39;match&#39;&gt;ise&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;th&lt;span class=&#39;match&#39;&gt;ing&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;验证字母q后边是否总是跟着字母u，也就是说查找那些q后边不是u的单词：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(words,&amp;quot;q[^u]&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div id=&#34;htmlwidget-15&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-15&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt; 结果是没找到。&lt;/p&gt;
&lt;p&gt;验证另外一个字母搭配规则，i在e前或者是在c后边。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str_view(words,&amp;quot;ie|ci&amp;quot;,match = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-16&#34; style=&#34;width:960px;height:auto;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-16&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;ach&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;ve&lt;\/li&gt;\n  &lt;li&gt;asso&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;ate&lt;\/li&gt;\n  &lt;li&gt;bel&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;ve&lt;\/li&gt;\n  &lt;li&gt;br&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;f&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;ty&lt;\/li&gt;\n  &lt;li&gt;cl&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;nt&lt;\/li&gt;\n  &lt;li&gt;coun&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;l&lt;\/li&gt;\n  &lt;li&gt;de&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;de&lt;\/li&gt;\n  &lt;li&gt;de&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;sion&lt;\/li&gt;\n  &lt;li&gt;d&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;espe&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;al&lt;\/li&gt;\n  &lt;li&gt;exer&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;se&lt;\/li&gt;\n  &lt;li&gt;exper&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;nce&lt;\/li&gt;\n  &lt;li&gt;f&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;ld&lt;\/li&gt;\n  &lt;li&gt;fr&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;nd&lt;\/li&gt;\n  &lt;li&gt;l&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;p&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;ce&lt;\/li&gt;\n  &lt;li&gt;qu&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;t&lt;\/li&gt;\n  &lt;li&gt;s&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;ence&lt;\/li&gt;\n  &lt;li&gt;so&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;al&lt;\/li&gt;\n  &lt;li&gt;so&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;ety&lt;\/li&gt;\n  &lt;li&gt;spe&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;al&lt;\/li&gt;\n  &lt;li&gt;spe&lt;span class=&#39;match&#39;&gt;ci&lt;\/span&gt;fic&lt;\/li&gt;\n  &lt;li&gt;t&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;v&lt;span class=&#39;match&#39;&gt;ie&lt;\/span&gt;w&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>windows系统下转换Rmd文档为PDF文档</title>
      <link>/post/rmd-to-pdf-in-r/</link>
      <pubDate>Sun, 07 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/rmd-to-pdf-in-r/</guid>
      <description>&lt;p&gt;如何将Rmd文档输出为PDF，一直是一个挑战性的工作，我在windows系统上就没有成功过。主要是搞不定巨大的tex安装包。不过最近有个好消息，&lt;a href=&#34;https://yihui.name/&#34;&gt;yihui&lt;/a&gt;开发了&lt;a href=&#34;https://yihui.name/tinytex/&#34;&gt;tinytex&lt;/a&gt;包，自动化了tex包的安装和配置工作。目前，这个包已经挂在cran上，可以通过rstudio安装。&lt;/p&gt;
&lt;p&gt;安装tinytex后，在Rstudio中有以下2点需要配置：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;点击Tools菜单-&amp;gt; Global Options-&amp;gt; sweave：typeset LaTeX into PDF using: 修改为XeLaTeX。&lt;/li&gt;
&lt;li&gt;knit Output Options部分，在Advanced中注意同样选择为XeLaTex。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;文件中如果包括中文，有两个方面需要注意：&lt;/p&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. 文本中包括中文&lt;/h2&gt;
&lt;p&gt;参考这个&lt;a href=&#34;https://www.jianshu.com/p/0bfda49f1a52&#34;&gt;链接&lt;/a&gt;，进行如下设置：&lt;/p&gt;
&lt;pre class=&#34;tex&#34;&gt;&lt;code&gt;\usepackage{xeCJK}  
\setCJKmainfont{simsun.ttc}  % 字体可以更换&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;把上述代码单独保存为一个文件，如header.tex，注意与Rmd文件在同一个路径下。其作用貌似是调用xeCJK包，中文字体设置为宋体。如果tinytex检测到系统中没有安装xeCJK包，那么会自动下载安装。&lt;/p&gt;
&lt;p&gt;但是尝试了一下，好像tinytex自动安装xeCJK存在问题，包的名称应该全部是小写。在Rstudio的console中手动安装，&lt;strong&gt;注意xecjk需要全部为小写&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;tinytex::tlmgr_install(“xecjk”)&lt;/p&gt;
&lt;p&gt;ps: 安装了rmarkdown最新开发版，上述问题就解决了：&lt;code&gt;devtools::install_github(&amp;quot;rstudio/rmarkdown&amp;quot;)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后，在新建立的Rmd文档中YAML头中，设置包括header.tex文件：&lt;/p&gt;
&lt;pre class=&#34;yaml&#34;&gt;&lt;code&gt;output: 
  pdf_document: 
    includes:
      in_header: header.tex
    keep_tex: yes
    latex_engine: xelatex&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;2.图片中中文设置&lt;/h2&gt;
&lt;p&gt;主要是利用showtext包完成，具体参考&lt;a href=&#34;https://luansheng.netlify.com/post/using-other-system-chinese-fonts-in-r/&#34;&gt;此篇blog&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;点击下载&lt;a href=&#34;/post/RmdtoPDF.zip&#34;&gt;Rmd文档和生成的PDF文档&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>如何在EV3上安装ev3dev系统 </title>
      <link>/post/how-to-install-ev3dev/</link>
      <pubDate>Sat, 06 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/how-to-install-ev3dev/</guid>
      <description>&lt;p&gt;EV3是乐高机器人，除了官方系统，有人进行逆向工程，建立了一个基于Debian的开源linux系统&lt;a href=&#34;http://www.ev3dev.org/&#34;&gt;EV3DEV&lt;/a&gt;。然后就可以利用python等编程语言，控制EV3机器人。本文记录基于Windows 10系统的安装过程。&lt;/p&gt;
&lt;p&gt;详细的过程，可以参考官方网站&lt;a href=&#34;http://www.ev3dev.org/docs/getting-started/&#34;&gt;Getting Started with ev3dev&lt;/a&gt;。&lt;/p&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. 准备的硬件&lt;/h2&gt;
&lt;p&gt;需要一个micro SD卡，我购买的是&lt;a href=&#34;https://item.jd.com/343546.html&#34;&gt;金士顿（Kingston）16GB Class4 TF(Micro SD)存储卡&lt;/a&gt;。看官网介绍，大于32G的卡，EV3读不出来。&lt;/p&gt;
&lt;p&gt;另外需要一个读卡器，同样购买的&lt;a href=&#34;https://item.jd.com/343389.html&#34;&gt;金士顿（Kingston）USB 2.0 TF（Micro SD）读卡器（FCR-MRG2）&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;还需要一台计算机，最好是笔记本电脑，支持蓝牙或者wifi无线网络。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ev3dev&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;2.制作EV3DEV启动盘&lt;/h2&gt;
&lt;div id=&#34;ev3dev&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;2.1 下载EV3DEV镜像文件。&lt;/h3&gt;
&lt;p&gt;目前官网上的下载地址下载不了，通过其&lt;a href=&#34;https://github.com/ev3dev&#34;&gt;github&lt;/a&gt;找到了下载地址，在&lt;a href=&#34;https://github.com/ev3dev/ev3dev/releases&#34;&gt;这里&lt;/a&gt;，目前最新的是2017-09-14发布的镜像文件。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;sd&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;2.2 把镜像文件烧录到sd卡&lt;/h3&gt;
&lt;p&gt;下载原文中推荐的img镜像烧录软件&lt;a href=&#34;https://etcher.io/&#34;&gt;etcher&lt;/a&gt;，这个软件使用简单，非常好用。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;ev3devev3&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;3. 利用EV3DEV启动EV3&lt;/h2&gt;
&lt;p&gt;把&lt;strong&gt;sd卡正面跟EV3正面一个方向&lt;/strong&gt;，插入卡槽中。然后从EV3主机上按启动键，会出现一个带有小企鹅的启动画面，启动需要等一段时间。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ev3&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;4. 通过蓝牙连接EV3主机与电脑&lt;/h2&gt;
&lt;p&gt;为了控制EV3，必须要有另外一台电脑，与EV3建立连接，控制EV3。本文推荐蓝牙连接。因为如果想通过wifi连接，还需要再买一个EV3专用的无线网卡。&lt;/p&gt;
&lt;p&gt;具体的连接方法，参考&lt;a href=&#34;http://www.ev3dev.org/docs/tutorials/connecting-to-the-internet-via-bluetooth/&#34;&gt;这里&lt;/a&gt;。请注意，文中给出了连接安卓、苹果和windows三个系统的蓝牙连接设置方法，win10的设置在网页最下边。务必要严格按照网页要求的步骤来设置。&lt;/p&gt;
&lt;p&gt;但是，目前按照这个教程，设置EV3跟电脑蓝牙连接后，EV3并不能通过蓝牙连接电脑的无线网络上网。这是一个当前&lt;strong&gt;还没有解决的问题&lt;/strong&gt;。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;sshev3&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;5. 通过SSH协议登录并控制EV3主机&lt;/h2&gt;
&lt;p&gt;如果是win10系统，下载一个&lt;a href=&#34;https://www.chiark.greenend.org.uk/~sgtatham/putty/&#34;&gt;putty软件&lt;/a&gt;，然后填入在EV3主机中显示的IP地址，譬如：169.254.26.0，然后点击open，会弹出一个黑色的命令行窗口，稍微等一会，根据提示输入用户名：&lt;strong&gt;robot&lt;/strong&gt;，回车后，根据提示输入密码：&lt;strong&gt;maker&lt;/strong&gt;，然后等一会，如果登陆成功，会显示如下画面：&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/post/images/puttyev3.png&#34; title=&#34;putty成功登陆EV3&#34; alt=&#34;putty成功登陆EV3&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;putty成功登陆EV3&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;pythonev3&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;6. 通过python控制EV3&lt;/h2&gt;
&lt;p&gt;可以认为，python是EV3DEV系统支持的官方语言。想学习如何利用pyhton控制EV3，可以参考&lt;a href=&#34;http://python-ev3dev.readthedocs.io/en/stable/&#34;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;div id=&#34;ev3&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;6.1 控制EV3说话&lt;/h3&gt;
&lt;p&gt;“hello,world”是编程学习时的经典输出语句。下边我们试着让EV3直接说出来：&lt;/p&gt;
&lt;p&gt;首先在成功连接EV3的putty窗口中，输入&lt;strong&gt;python3&lt;/strong&gt;，启动python环境，成功后是这样：&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/post/images/puttyev3python.png&#34; title=&#34;EV3上启动python3&#34; alt=&#34;EV3上启动python3&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;EV3上启动python3&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;然后在python控制台下，输入下列命令：&lt;/p&gt;
&lt;pre class=&#34;python&#34;&gt;&lt;code&gt;#导入ev3dev.ev3模块
import ev3dev.ev3 as ev3

#调用ev3的声音模块发出声音
ev3.Sound.speak(&amp;#39;hello,world&amp;#39;).wait()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;程序运行成功后的putty窗口：&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/post/images/puttyev3helloworld.png&#34; title=&#34;EV3说出hello, world&#34; alt=&#34;EV3说出hello, world&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;EV3说出hello, world&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;6.2 控制马达转动&lt;/h3&gt;
&lt;pre class=&#34;python&#34;&gt;&lt;code&gt;#控制连接到主机A端口的一个大型马达
m = ev3.LargeMotor(&amp;#39;outA&amp;#39;)

# speed_sp控制马达转速，这里的用的是ticks per second
# time_sp控制马达的启动时间，表示的是毫秒
m.run_timed(time_sp=3000, speed_sp=500)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;todo&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;todo&lt;/h3&gt;
&lt;p&gt;如何把电脑写好的python程序传输到EV3上并执行？&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.ev3dev.org/docs/tutorials/&#34;&gt;EV3DEV教程中心&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://python-ev3dev.readthedocs.io/en/stable/rpyc.html&#34;&gt;Working with ev3dev remotely using RPyC&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>try od package</title>
      <link>/post/try-od-package/</link>
      <pubDate>Wed, 03 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/try-od-package/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://asreml.org/optimal-design/&#34;&gt;od&lt;/a&gt;包是一个可以给出数量遗传学&lt;strong&gt;优化试验设计&lt;/strong&gt;的包。试着通过实例来理解背后的设计原理。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://asreml.org/resources/od/od_0.75.zip&#34;&gt;windows&lt;/a&gt;包没有自带数据，从&lt;a href=&#34;https://asreml.org/resources/od/od_0.75_R_linux-intel64.tar.gz&#34;&gt;linux&lt;/a&gt;包中把数据提出来。&lt;/p&gt;
&lt;p&gt;关于od包背后的设计原理，参考作者的博士论文：On The Optimal Design of Experiments Under the Linear Mixed Model。&lt;/p&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. 加载数据文件&lt;/h2&gt;
&lt;p&gt;genex是一个作物遗传改良的实验数据，包括213个品种。实验设计为部分重复设计，包括2个Block,每个block内有48行×3列。部分品种有2次实验记录。 genex.Ainv 包括了213个品种间的加性遗传相关矩阵。注意od包要求genex.Ainv数据框包括一个属性rowNames,存储row列中整数对应的品种名。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(data.table)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的程辑包：data.table&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;genex &amp;lt;- fread(file=&amp;quot;genex.csv&amp;quot;,stringsAsFactors = TRUE)
genex[,&amp;quot;:=&amp;quot;(Row=as.factor(Row),Block=as.factor(Block),Column=as.factor(Column))]
genex.Ainv &amp;lt;- fread(file=&amp;quot;genex.Ainv.csv&amp;quot;,stringsAsFactors = TRUE)
genex.Ainv.rowNames &amp;lt;- fread(file=&amp;quot;genex.Ainv.rowNames.csv&amp;quot;,sep=&amp;quot;,&amp;quot;,stringsAsFactors = FALSE,header = FALSE)
attr(genex.Ainv,which = &amp;quot;rowNames&amp;quot;) &amp;lt;- genex.Ainv.rowNames$V1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(od)
genex.G &amp;lt;- od.init(`ped(Entry)` = 1, `ide(Entry)` = 0.1, Block = 0.1,Column = 0.4, Row = 0.2)
genex.R &amp;lt;- od.init(`Column:Row|Column` = 0.2, `Column:Row|Row` = 0.5)
genex.od &amp;lt;- od(random = ~ped(Entry) + ide(Entry) + Block + Column + Row, 
               rcov = ~ar1(Column):ar1(Row), 
               permute = ~ped(Entry) |ide(Entry),
               swap = ~Block, Gstart = genex.G, 
               Rstart = genex.R,
               ginv = list(Entry = genex.Ainv), 
               geneticEffects = &amp;quot;total&amp;quot;,
               search = &amp;quot;tabu&amp;quot;, 
               maxit = 5, 
               data = genex)
save.image()&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;genex.od$design&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>我的第一个python程序</title>
      <link>/post/my-first-python-program/</link>
      <pubDate>Tue, 02 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/my-first-python-program/</guid>
      <description>&lt;p&gt;参考&lt;a href=&#34;http://pandas.pydata.org/&#34;&gt;pandas官网&lt;/a&gt;，&lt;a href=&#34;http://pandas.pydata.org/pandas-docs/stable/10min.html&#34;&gt;十分钟教程&lt;/a&gt;&lt;/p&gt;
&lt;pre class=&#34;python&#34;&gt;&lt;code&gt;import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
s = pd.Series([1,3,5,np.nan,6,8])
print(s)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 0    1.0
## 1    3.0
## 2    5.0
## 3    NaN
## 4    6.0
## 5    8.0
## dtype: float64&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>在R中使用windows系统自带的中文字体</title>
      <link>/post/using-other-system-chinese-fonts-in-r/</link>
      <pubDate>Sun, 31 Dec 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/using-other-system-chinese-fonts-in-r/</guid>
      <description>&lt;p&gt;R作图时，如何在图片中使用windows系统自带的其他中文字体？以前尝试过好几次，都没有成功。&lt;/p&gt;
&lt;p&gt;首先安装二个包：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cran.r-project.org/web/packages/sysfonts/index.html&#34;&gt;sysfonts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cran.r-project.org/web/packages/showtext/index.html&#34;&gt;showtext&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;R中自带的默认字体家族，可以通过sysfonts::font.families()函数查看：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(sysfonts)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的程辑包：sysfonts&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(showtext)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的程辑包：showtext&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的程辑包：showtextdb&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;font_families()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;sans&amp;quot;         &amp;quot;serif&amp;quot;        &amp;quot;mono&amp;quot;         &amp;quot;wqy-microhei&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;R中自带的三种标准字体家族为：&lt;a href=&#34;https://baike.baidu.com/item/衬线字体/6820704?fr=aladdin&#34;&gt;serif&lt;/a&gt;（衬线）、&lt;a href=&#34;https://baike.baidu.com/item/无衬线体/2374029&#34;&gt;sans&lt;/a&gt;（无衬线）和&lt;a href=&#34;https://baike.baidu.com/item/等宽字体/8434037?fr=aladdin&#34;&gt;mono&lt;/a&gt;（等宽）三类。&lt;/p&gt;
&lt;p&gt;如果想使用Windows系统中自带的中文字体，首先查看系统中字体存储路径：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;font_paths()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;C:\\Windows\\Fonts&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;进一步查看有哪些可以利用的字体文件：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;font_files()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] &amp;quot;AGENCYB.TTF&amp;quot;             &amp;quot;AGENCYR.TTF&amp;quot;            
##   [3] &amp;quot;ALGER.TTF&amp;quot;               &amp;quot;ANTQUAB.TTF&amp;quot;            
##   [5] &amp;quot;ANTQUABI.TTF&amp;quot;            &amp;quot;ANTQUAI.TTF&amp;quot;            
##   [7] &amp;quot;arial.ttf&amp;quot;               &amp;quot;arialbd.ttf&amp;quot;            
##   [9] &amp;quot;arialbi.ttf&amp;quot;             &amp;quot;ariali.ttf&amp;quot;             
##  [11] &amp;quot;ARIALN.TTF&amp;quot;              &amp;quot;ARIALNB.TTF&amp;quot;            
##  [13] &amp;quot;ARIALNBI.TTF&amp;quot;            &amp;quot;ARIALNI.TTF&amp;quot;            
##  [15] &amp;quot;ARIALUNI.TTF&amp;quot;            &amp;quot;ariblk.ttf&amp;quot;             
##  [17] &amp;quot;ARLRDBD.TTF&amp;quot;             &amp;quot;bahnschrift.ttf&amp;quot;        
##  [19] &amp;quot;BASKVILL.TTF&amp;quot;            &amp;quot;BAUHS93.TTF&amp;quot;            
##  [21] &amp;quot;BELL.TTF&amp;quot;                &amp;quot;BELLB.TTF&amp;quot;              
##  [23] &amp;quot;BELLI.TTF&amp;quot;               &amp;quot;BERNHC.TTF&amp;quot;             
##  [25] &amp;quot;BKANT.TTF&amp;quot;               &amp;quot;BOD_B.TTF&amp;quot;              
##  [27] &amp;quot;BOD_BI.TTF&amp;quot;              &amp;quot;BOD_BLAI.TTF&amp;quot;           
##  [29] &amp;quot;BOD_BLAR.TTF&amp;quot;            &amp;quot;BOD_CB.TTF&amp;quot;             
##  [31] &amp;quot;BOD_CBI.TTF&amp;quot;             &amp;quot;BOD_CI.TTF&amp;quot;             
##  [33] &amp;quot;BOD_CR.TTF&amp;quot;              &amp;quot;BOD_I.TTF&amp;quot;              
##  [35] &amp;quot;BOD_PSTC.TTF&amp;quot;            &amp;quot;BOD_R.TTF&amp;quot;              
##  [37] &amp;quot;BOOKOS.TTF&amp;quot;              &amp;quot;BOOKOSB.TTF&amp;quot;            
##  [39] &amp;quot;BOOKOSBI.TTF&amp;quot;            &amp;quot;BOOKOSI.TTF&amp;quot;            
##  [41] &amp;quot;BRADHITC.TTF&amp;quot;            &amp;quot;BRITANIC.TTF&amp;quot;           
##  [43] &amp;quot;BRLNSB.TTF&amp;quot;              &amp;quot;BRLNSDB.TTF&amp;quot;            
##  [45] &amp;quot;BRLNSR.TTF&amp;quot;              &amp;quot;BROADW.TTF&amp;quot;             
##  [47] &amp;quot;BRUSHSCI.TTF&amp;quot;            &amp;quot;BSSYM7.TTF&amp;quot;             
##  [49] &amp;quot;calibri.ttf&amp;quot;             &amp;quot;calibrib.ttf&amp;quot;           
##  [51] &amp;quot;calibrii.ttf&amp;quot;            &amp;quot;calibril.ttf&amp;quot;           
##  [53] &amp;quot;calibrili.ttf&amp;quot;           &amp;quot;calibriz.ttf&amp;quot;           
##  [55] &amp;quot;CALIFB.TTF&amp;quot;              &amp;quot;CALIFI.TTF&amp;quot;             
##  [57] &amp;quot;CALIFR.TTF&amp;quot;              &amp;quot;CALIST.TTF&amp;quot;             
##  [59] &amp;quot;CALISTB.TTF&amp;quot;             &amp;quot;CALISTBI.TTF&amp;quot;           
##  [61] &amp;quot;CALISTI.TTF&amp;quot;             &amp;quot;cambria.ttc&amp;quot;            
##  [63] &amp;quot;cambriab.ttf&amp;quot;            &amp;quot;cambriai.ttf&amp;quot;           
##  [65] &amp;quot;cambriaz.ttf&amp;quot;            &amp;quot;Candara.ttf&amp;quot;            
##  [67] &amp;quot;Candarab.ttf&amp;quot;            &amp;quot;Candarai.ttf&amp;quot;           
##  [69] &amp;quot;Candaraz.ttf&amp;quot;            &amp;quot;CASTELAR.TTF&amp;quot;           
##  [71] &amp;quot;CENSCBK.TTF&amp;quot;             &amp;quot;CENTAUR.TTF&amp;quot;            
##  [73] &amp;quot;CENTURY.TTF&amp;quot;             &amp;quot;CHILLER.TTF&amp;quot;            
##  [75] &amp;quot;COLONNA.TTF&amp;quot;             &amp;quot;comic.ttf&amp;quot;              
##  [77] &amp;quot;comicbd.ttf&amp;quot;             &amp;quot;comici.ttf&amp;quot;             
##  [79] &amp;quot;comicz.ttf&amp;quot;              &amp;quot;consola.ttf&amp;quot;            
##  [81] &amp;quot;consolab.ttf&amp;quot;            &amp;quot;consolai.ttf&amp;quot;           
##  [83] &amp;quot;consolaz.ttf&amp;quot;            &amp;quot;constan.ttf&amp;quot;            
##  [85] &amp;quot;constanb.ttf&amp;quot;            &amp;quot;constani.ttf&amp;quot;           
##  [87] &amp;quot;constanz.ttf&amp;quot;            &amp;quot;COOPBL.TTF&amp;quot;             
##  [89] &amp;quot;COPRGTB.TTF&amp;quot;             &amp;quot;COPRGTL.TTF&amp;quot;            
##  [91] &amp;quot;corbel.ttf&amp;quot;              &amp;quot;corbelb.ttf&amp;quot;            
##  [93] &amp;quot;corbeli.ttf&amp;quot;             &amp;quot;corbelz.ttf&amp;quot;            
##  [95] &amp;quot;cour.ttf&amp;quot;                &amp;quot;courbd.ttf&amp;quot;             
##  [97] &amp;quot;courbi.ttf&amp;quot;              &amp;quot;couri.ttf&amp;quot;              
##  [99] &amp;quot;CURLZ___.TTF&amp;quot;            &amp;quot;Deng.ttf&amp;quot;               
## [101] &amp;quot;Dengb.ttf&amp;quot;               &amp;quot;Dengl.ttf&amp;quot;              
## [103] &amp;quot;ebrima.ttf&amp;quot;              &amp;quot;ebrimabd.ttf&amp;quot;           
## [105] &amp;quot;ELEPHNT.TTF&amp;quot;             &amp;quot;ELEPHNTI.TTF&amp;quot;           
## [107] &amp;quot;ENGR.TTF&amp;quot;                &amp;quot;ERASBD.TTF&amp;quot;             
## [109] &amp;quot;ERASDEMI.TTF&amp;quot;            &amp;quot;ERASLGHT.TTF&amp;quot;           
## [111] &amp;quot;ERASMD.TTF&amp;quot;              &amp;quot;euclid.ttf&amp;quot;             
## [113] &amp;quot;euclidb.ttf&amp;quot;             &amp;quot;euclidbi.ttf&amp;quot;           
## [115] &amp;quot;euclidi.ttf&amp;quot;             &amp;quot;eucsym.ttf&amp;quot;             
## [117] &amp;quot;eucsymb.ttf&amp;quot;             &amp;quot;eucsymbi.ttf&amp;quot;           
## [119] &amp;quot;eucsymi.ttf&amp;quot;             &amp;quot;euextra.ttf&amp;quot;            
## [121] &amp;quot;euextrab.ttf&amp;quot;            &amp;quot;eufrak.ttf&amp;quot;             
## [123] &amp;quot;eufrakb.ttf&amp;quot;             &amp;quot;eumat1.ttf&amp;quot;             
## [125] &amp;quot;eumat1b.ttf&amp;quot;             &amp;quot;eumat2.ttf&amp;quot;             
## [127] &amp;quot;eumat2b.ttf&amp;quot;             &amp;quot;FELIXTI.TTF&amp;quot;            
## [129] &amp;quot;fences.ttf&amp;quot;              &amp;quot;FORTE.TTF&amp;quot;              
## [131] &amp;quot;FRABK.TTF&amp;quot;               &amp;quot;FRABKIT.TTF&amp;quot;            
## [133] &amp;quot;FRADM.TTF&amp;quot;               &amp;quot;FRADMCN.TTF&amp;quot;            
## [135] &amp;quot;FRADMIT.TTF&amp;quot;             &amp;quot;FRAHV.TTF&amp;quot;              
## [137] &amp;quot;FRAHVIT.TTF&amp;quot;             &amp;quot;framd.ttf&amp;quot;              
## [139] &amp;quot;FRAMDCN.TTF&amp;quot;             &amp;quot;framdit.ttf&amp;quot;            
## [141] &amp;quot;FREESCPT.TTF&amp;quot;            &amp;quot;FRSCRIPT.TTF&amp;quot;           
## [143] &amp;quot;FTLTLT.TTF&amp;quot;              &amp;quot;FZLTCXHJW.TTF&amp;quot;          
## [145] &amp;quot;FZSTK.TTF&amp;quot;               &amp;quot;FZYTK.TTF&amp;quot;              
## [147] &amp;quot;Gabriola.ttf&amp;quot;            &amp;quot;gadugi.ttf&amp;quot;             
## [149] &amp;quot;gadugib.ttf&amp;quot;             &amp;quot;GARA.TTF&amp;quot;               
## [151] &amp;quot;GARABD.TTF&amp;quot;              &amp;quot;GARAIT.TTF&amp;quot;             
## [153] &amp;quot;georgia.ttf&amp;quot;             &amp;quot;georgiab.ttf&amp;quot;           
## [155] &amp;quot;georgiai.ttf&amp;quot;            &amp;quot;georgiaz.ttf&amp;quot;           
## [157] &amp;quot;GIGI.TTF&amp;quot;                &amp;quot;GIL_____.TTF&amp;quot;           
## [159] &amp;quot;GILB____.TTF&amp;quot;            &amp;quot;GILBI___.TTF&amp;quot;           
## [161] &amp;quot;GILC____.TTF&amp;quot;            &amp;quot;GILI____.TTF&amp;quot;           
## [163] &amp;quot;GILLUBCD.TTF&amp;quot;            &amp;quot;GILSANUB.TTF&amp;quot;           
## [165] &amp;quot;GLECB.TTF&amp;quot;               &amp;quot;GLSNECB.TTF&amp;quot;            
## [167] &amp;quot;GOTHIC.TTF&amp;quot;              &amp;quot;GOTHICB.TTF&amp;quot;            
## [169] &amp;quot;GOTHICBI.TTF&amp;quot;            &amp;quot;GOTHICI.TTF&amp;quot;            
## [171] &amp;quot;GOUDOS.TTF&amp;quot;              &amp;quot;GOUDOSB.TTF&amp;quot;            
## [173] &amp;quot;GOUDOSI.TTF&amp;quot;             &amp;quot;GOUDYSTO.TTF&amp;quot;           
## [175] &amp;quot;HARLOWSI.TTF&amp;quot;            &amp;quot;HARNGTON.TTF&amp;quot;           
## [177] &amp;quot;HATTEN.TTF&amp;quot;              &amp;quot;himalaya.ttf&amp;quot;           
## [179] &amp;quot;holomdl2.ttf&amp;quot;            &amp;quot;HTOWERT.TTF&amp;quot;            
## [181] &amp;quot;HTOWERTI.TTF&amp;quot;            &amp;quot;impact.ttf&amp;quot;             
## [183] &amp;quot;IMPRISHA.TTF&amp;quot;            &amp;quot;INFROMAN.TTF&amp;quot;           
## [185] &amp;quot;ITCBLKAD.TTF&amp;quot;            &amp;quot;ITCEDSCR.TTF&amp;quot;           
## [187] &amp;quot;ITCKRIST.TTF&amp;quot;            &amp;quot;javatext.ttf&amp;quot;           
## [189] &amp;quot;JOKERMAN.TTF&amp;quot;            &amp;quot;JUICE___.TTF&amp;quot;           
## [191] &amp;quot;KUNSTLER.TTF&amp;quot;            &amp;quot;l_10646.ttf&amp;quot;            
## [193] &amp;quot;LATINWD.TTF&amp;quot;             &amp;quot;LBRITE.TTF&amp;quot;             
## [195] &amp;quot;LBRITED.TTF&amp;quot;             &amp;quot;LBRITEDI.TTF&amp;quot;           
## [197] &amp;quot;LBRITEI.TTF&amp;quot;             &amp;quot;LCALLIG.TTF&amp;quot;            
## [199] &amp;quot;LeelaUIb.ttf&amp;quot;            &amp;quot;LeelawUI.ttf&amp;quot;           
## [201] &amp;quot;LeelUIsl.ttf&amp;quot;            &amp;quot;LFAX.TTF&amp;quot;               
## [203] &amp;quot;LFAXD.TTF&amp;quot;               &amp;quot;LFAXDI.TTF&amp;quot;             
## [205] &amp;quot;LFAXI.TTF&amp;quot;               &amp;quot;LHANDW.TTF&amp;quot;             
## [207] &amp;quot;LSANS.TTF&amp;quot;               &amp;quot;LSANSD.TTF&amp;quot;             
## [209] &amp;quot;LSANSDI.TTF&amp;quot;             &amp;quot;LSANSI.TTF&amp;quot;             
## [211] &amp;quot;LTYPE.TTF&amp;quot;               &amp;quot;LTYPEB.TTF&amp;quot;             
## [213] &amp;quot;LTYPEBO.TTF&amp;quot;             &amp;quot;LTYPEO.TTF&amp;quot;             
## [215] &amp;quot;lucon.ttf&amp;quot;               &amp;quot;MAGNETOB.TTF&amp;quot;           
## [217] &amp;quot;MAIAN.TTF&amp;quot;               &amp;quot;malgun.ttf&amp;quot;             
## [219] &amp;quot;malgunbd.ttf&amp;quot;            &amp;quot;malgunsl.ttf&amp;quot;           
## [221] &amp;quot;marlett.ttf&amp;quot;             &amp;quot;MATURASC.TTF&amp;quot;           
## [223] &amp;quot;micross.ttf&amp;quot;             &amp;quot;mingliub.ttc&amp;quot;           
## [225] &amp;quot;MISTRAL.TTF&amp;quot;             &amp;quot;mmrtext.ttf&amp;quot;            
## [227] &amp;quot;mmrtextb.ttf&amp;quot;            &amp;quot;MOD20.TTF&amp;quot;              
## [229] &amp;quot;monbaiti.ttf&amp;quot;            &amp;quot;msgothic.ttc&amp;quot;           
## [231] &amp;quot;msjh.ttc&amp;quot;                &amp;quot;msjhbd.ttc&amp;quot;             
## [233] &amp;quot;msjhl.ttc&amp;quot;               &amp;quot;msyh.ttc&amp;quot;               
## [235] &amp;quot;msyhbd.ttc&amp;quot;              &amp;quot;msyhl.ttc&amp;quot;              
## [237] &amp;quot;msyi.ttf&amp;quot;                &amp;quot;Mt Extra Tiger.ttf&amp;quot;     
## [239] &amp;quot;MTCORSVA.TTF&amp;quot;            &amp;quot;mtextra.ttf&amp;quot;            
## [241] &amp;quot;mvboli.ttf&amp;quot;              &amp;quot;NIAGENG.TTF&amp;quot;            
## [243] &amp;quot;NIAGSOL.TTF&amp;quot;             &amp;quot;Nirmala.ttf&amp;quot;            
## [245] &amp;quot;NirmalaB.ttf&amp;quot;            &amp;quot;NirmalaS.ttf&amp;quot;           
## [247] &amp;quot;ntailu.ttf&amp;quot;              &amp;quot;ntailub.ttf&amp;quot;            
## [249] &amp;quot;OCRAEXT.TTF&amp;quot;             &amp;quot;OLDENGL.TTF&amp;quot;            
## [251] &amp;quot;ONYX.TTF&amp;quot;                &amp;quot;OUTLOOK.TTF&amp;quot;            
## [253] &amp;quot;pala.ttf&amp;quot;                &amp;quot;palab.ttf&amp;quot;              
## [255] &amp;quot;palabi.ttf&amp;quot;              &amp;quot;palai.ttf&amp;quot;              
## [257] &amp;quot;PALSCRI.TTF&amp;quot;             &amp;quot;PAPYRUS.TTF&amp;quot;            
## [259] &amp;quot;PARCHM.TTF&amp;quot;              &amp;quot;PER_____.TTF&amp;quot;           
## [261] &amp;quot;PERB____.TTF&amp;quot;            &amp;quot;PERBI___.TTF&amp;quot;           
## [263] &amp;quot;PERI____.TTF&amp;quot;            &amp;quot;PERTIBD.TTF&amp;quot;            
## [265] &amp;quot;PERTILI.TTF&amp;quot;             &amp;quot;phagspa.ttf&amp;quot;            
## [267] &amp;quot;phagspab.ttf&amp;quot;            &amp;quot;PLAYBILL.TTF&amp;quot;           
## [269] &amp;quot;POORICH.TTF&amp;quot;             &amp;quot;PRISTINA.TTF&amp;quot;           
## [271] &amp;quot;RAGE.TTF&amp;quot;                &amp;quot;RAVIE.TTF&amp;quot;              
## [273] &amp;quot;REFSAN.TTF&amp;quot;              &amp;quot;REFSPCL.TTF&amp;quot;            
## [275] &amp;quot;ROCC____.TTF&amp;quot;            &amp;quot;ROCCB___.TTF&amp;quot;           
## [277] &amp;quot;ROCK.TTF&amp;quot;                &amp;quot;ROCKB.TTF&amp;quot;              
## [279] &amp;quot;ROCKBI.TTF&amp;quot;              &amp;quot;ROCKEB.TTF&amp;quot;             
## [281] &amp;quot;ROCKI.TTF&amp;quot;               &amp;quot;SCHLBKB.TTF&amp;quot;            
## [283] &amp;quot;SCHLBKBI.TTF&amp;quot;            &amp;quot;SCHLBKI.TTF&amp;quot;            
## [285] &amp;quot;SCRIPTBL.TTF&amp;quot;            &amp;quot;segmdl2.ttf&amp;quot;            
## [287] &amp;quot;segoepr.ttf&amp;quot;             &amp;quot;segoeprb.ttf&amp;quot;           
## [289] &amp;quot;segoesc.ttf&amp;quot;             &amp;quot;segoescb.ttf&amp;quot;           
## [291] &amp;quot;segoeui.ttf&amp;quot;             &amp;quot;segoeuib.ttf&amp;quot;           
## [293] &amp;quot;segoeuii.ttf&amp;quot;            &amp;quot;segoeuil.ttf&amp;quot;           
## [295] &amp;quot;segoeuisl.ttf&amp;quot;           &amp;quot;segoeuiz.ttf&amp;quot;           
## [297] &amp;quot;seguibl.ttf&amp;quot;             &amp;quot;seguibli.ttf&amp;quot;           
## [299] &amp;quot;seguiemj.ttf&amp;quot;            &amp;quot;seguihis.ttf&amp;quot;           
## [301] &amp;quot;seguili.ttf&amp;quot;             &amp;quot;seguisb.ttf&amp;quot;            
## [303] &amp;quot;seguisbi.ttf&amp;quot;            &amp;quot;seguisli.ttf&amp;quot;           
## [305] &amp;quot;seguisym.ttf&amp;quot;            &amp;quot;SHOWG.TTF&amp;quot;              
## [307] &amp;quot;simfang.ttf&amp;quot;             &amp;quot;simhei.ttf&amp;quot;             
## [309] &amp;quot;simkai.ttf&amp;quot;              &amp;quot;SIMLI.TTF&amp;quot;              
## [311] &amp;quot;simsun.ttc&amp;quot;              &amp;quot;simsunb.ttf&amp;quot;            
## [313] &amp;quot;SIMYOU.TTF&amp;quot;              &amp;quot;Sitka.ttc&amp;quot;              
## [315] &amp;quot;SitkaB.ttc&amp;quot;              &amp;quot;SitkaI.ttc&amp;quot;             
## [317] &amp;quot;SitkaZ.ttc&amp;quot;              &amp;quot;SNAP____.TTF&amp;quot;           
## [319] &amp;quot;STCAIYUN.TTF&amp;quot;            &amp;quot;STENCIL.TTF&amp;quot;            
## [321] &amp;quot;STFANGSO.TTF&amp;quot;            &amp;quot;STHUPO.TTF&amp;quot;             
## [323] &amp;quot;STKAITI.TTF&amp;quot;             &amp;quot;STLITI.TTF&amp;quot;             
## [325] &amp;quot;STSONG.TTF&amp;quot;              &amp;quot;STXIHEI.TTF&amp;quot;            
## [327] &amp;quot;STXINGKA.TTF&amp;quot;            &amp;quot;STXINWEI.TTF&amp;quot;           
## [329] &amp;quot;STZHONGS.TTF&amp;quot;            &amp;quot;sylfaen.ttf&amp;quot;            
## [331] &amp;quot;Symbol Tiger Expert.ttf&amp;quot; &amp;quot;Symbol Tiger.ttf&amp;quot;       
## [333] &amp;quot;symbol.ttf&amp;quot;              &amp;quot;tahoma.ttf&amp;quot;             
## [335] &amp;quot;tahomabd.ttf&amp;quot;            &amp;quot;taile.ttf&amp;quot;              
## [337] &amp;quot;taileb.ttf&amp;quot;              &amp;quot;TCB_____.TTF&amp;quot;           
## [339] &amp;quot;TCBI____.TTF&amp;quot;            &amp;quot;TCCB____.TTF&amp;quot;           
## [341] &amp;quot;TCCEB.TTF&amp;quot;               &amp;quot;TCCM____.TTF&amp;quot;           
## [343] &amp;quot;TCM_____.TTF&amp;quot;            &amp;quot;TCMI____.TTF&amp;quot;           
## [345] &amp;quot;TEMPSITC.TTF&amp;quot;            &amp;quot;Tiger Expert.ttf&amp;quot;       
## [347] &amp;quot;Tiger.ttf&amp;quot;               &amp;quot;Times-Roman.ttf&amp;quot;        
## [349] &amp;quot;times.ttf&amp;quot;               &amp;quot;timesbd.ttf&amp;quot;            
## [351] &amp;quot;timesbi.ttf&amp;quot;             &amp;quot;timesi.ttf&amp;quot;             
## [353] &amp;quot;trebuc.ttf&amp;quot;              &amp;quot;trebucbd.ttf&amp;quot;           
## [355] &amp;quot;trebucbi.ttf&amp;quot;            &amp;quot;trebucit.ttf&amp;quot;           
## [357] &amp;quot;verdana.ttf&amp;quot;             &amp;quot;verdanab.ttf&amp;quot;           
## [359] &amp;quot;verdanai.ttf&amp;quot;            &amp;quot;verdanaz.ttf&amp;quot;           
## [361] &amp;quot;VINERITC.TTF&amp;quot;            &amp;quot;VIVALDII.TTF&amp;quot;           
## [363] &amp;quot;VLADIMIR.TTF&amp;quot;            &amp;quot;webdings.ttf&amp;quot;           
## [365] &amp;quot;wingding.ttf&amp;quot;            &amp;quot;WINGDNG2.TTF&amp;quot;           
## [367] &amp;quot;WINGDNG3.TTF&amp;quot;            &amp;quot;YuGothB.ttc&amp;quot;            
## [369] &amp;quot;YuGothL.ttc&amp;quot;             &amp;quot;YuGothM.ttc&amp;quot;            
## [371] &amp;quot;YuGothR.ttc&amp;quot;             &amp;quot;ZWAdobeF.TTF&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中宋体文件是simsun.ttc，黑体文件是：simhei.ttf，楷体文件是simkai.ttf，微软雅黑是msyh.ttf和msyhbd.ttf。&lt;/p&gt;
&lt;p&gt;尝试在R环境中加入黑体（如果字体是在Windows系统的默认字体库中，regular可以不用指定路径）：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;font_add(family = &amp;quot;heiti&amp;quot;,regular = &amp;quot;simhei.ttf&amp;quot;)
font_add(family = &amp;quot;kaiti&amp;quot;,regular = &amp;quot;simkai.ttf&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此时查看R中自带字体，你会发现多了“heiti”和“kaiti”。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;font.families()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## &amp;#39;font.families()&amp;#39; is now renamed to &amp;#39;font_families()&amp;#39;
## The old version still works, but consider using the new function in future code&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;sans&amp;quot;         &amp;quot;serif&amp;quot;        &amp;quot;mono&amp;quot;         &amp;quot;wqy-microhei&amp;quot;
## [5] &amp;quot;heiti&amp;quot;        &amp;quot;kaiti&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后我们在画图中使用黑体，借用showtext包作者邱逸轩的这篇文章&lt;a href=&#34;https://cosx.org/2014/01/showtext-interesting-fonts-and-graphs&#34;&gt;showtext：字体，好玩的字体和好玩的图形&lt;/a&gt;中的r示例代码：&lt;/p&gt;
&lt;p&gt;需要注意，&lt;strong&gt;rstudio自带的Plots面板中绘出的图形不显示自定义字体&lt;/strong&gt;，这也是以前总是觉得设置自定义字体不成功的原因。在运行下面的代码前，调用windows()函数打开一个新的图形接收窗口，下边代码绘制的图形会显示其中。&lt;/p&gt;
&lt;p&gt;如果你打算在Rmd文档中使用showtext包，请在chunk头参数中设置fig.showtext=TRUE。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;showtext_auto() #这样代码非常重要
set.seed(123)
plot(1, xlim = c(-3, 3), ylim = c(-3, 3), type = &amp;quot;n&amp;quot;)
text(runif(100, -3, 3), runif(100, -3, 3),
     intToUtf8(round(runif(100, 19968, 40869)), multiple = TRUE),
     col = rgb(runif(100), runif(100), runif(100), 0.5 + runif(100)/2),
     cex = 2, family = &amp;quot;heiti&amp;quot;)   # 指定heiti字体
title(&amp;quot;随机汉字&amp;quot;, family = &amp;quot;kaiti&amp;quot;)   # 指定kaiti字体&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-12-31-using-other-system-chinese-fonts-in-r_files/figure-html/fontexample-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;试一下ggplot2作图。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(ggplot2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的程辑包：ggplot2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;xy &amp;lt;- data.frame(x=rnorm(100),y=rnorm(100))
showtext_auto()
scatter.plot &amp;lt;- ggplot(data = xy,aes(x=x,y=y))+
  geom_point(shape=21)+
  labs(x=&amp;quot;均值为0，标准差为1的随机正态分布&amp;quot;,y=&amp;quot;均值为0，标准差为1的随机正态分布&amp;quot;)+
  theme_grey(base_size = 30,base_family = &amp;quot;heiti&amp;quot;)
print(scatter.plot)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:ggplot2example&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-12-31-using-other-system-chinese-fonts-in-r_files/figure-html/ggplot2example-1.png&#34; alt=&#34;基于0,1正态分布的散点图&#34; width=&#34;576&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: 基于0,1正态分布的散点图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Ok!大功告成！&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Take me to  your heart</title>
      <link>/post/take-me-to-your-heart/</link>
      <pubDate>Thu, 21 Dec 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/take-me-to-your-heart/</guid>
      <description>&lt;p&gt;Hiding from the rain and snow&lt;/p&gt;

&lt;p&gt;Trying to forget but I won&amp;rsquo;t let go&lt;/p&gt;

&lt;p&gt;Looking at a crowded street&lt;/p&gt;

&lt;p&gt;Listening to my own heart beat&lt;/p&gt;

&lt;p&gt;So many people all around the world&lt;/p&gt;

&lt;p&gt;Tell me where do I find someone like you girl&lt;/p&gt;

&lt;p&gt;(Chorus)&lt;/p&gt;

&lt;p&gt;Take me to your heart take me to your soul&lt;/p&gt;

&lt;p&gt;Give me your hand before I&amp;rsquo;m old&lt;/p&gt;

&lt;p&gt;Show me what love is - haven&amp;rsquo;t got a clue&lt;/p&gt;

&lt;p&gt;Show me that wonders can be true&lt;/p&gt;

&lt;p&gt;They say nothing lasts forever&lt;/p&gt;

&lt;p&gt;We&amp;rsquo;re only here today&lt;/p&gt;

&lt;p&gt;Love is now or never&lt;/p&gt;

&lt;p&gt;Bring me far away&lt;/p&gt;

&lt;p&gt;Take me to your heart take me to your soul&lt;/p&gt;

&lt;p&gt;Give me your hand and hold me&lt;/p&gt;

&lt;p&gt;Show me what love is - be my guiding star&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s easy take me to your heart&lt;/p&gt;

&lt;p&gt;Standing on a mountain high&lt;/p&gt;

&lt;p&gt;Looking at the moon through a clear blue sky&lt;/p&gt;

&lt;p&gt;I should go and see some friends&lt;/p&gt;

&lt;p&gt;But they don&amp;rsquo;t really comprehend&lt;/p&gt;

&lt;p&gt;Don&amp;rsquo;t need too much talking without saying anything&lt;/p&gt;

&lt;p&gt;All I need is someone who makes me wanna sing&lt;/p&gt;

&lt;p&gt;Take me to your heart take me to your soul&lt;/p&gt;

&lt;p&gt;Give me your hand before I&amp;rsquo;m old&lt;/p&gt;

&lt;p&gt;Show me what love is - haven&amp;rsquo;t got a clue&lt;/p&gt;

&lt;p&gt;Show me that wonders can be true&lt;/p&gt;

&lt;p&gt;They say nothing lasts forever&lt;/p&gt;

&lt;p&gt;We&amp;rsquo;re only here today&lt;/p&gt;

&lt;p&gt;Love is now or never&lt;/p&gt;

&lt;p&gt;Bring me far away&lt;/p&gt;

&lt;p&gt;Take me to your heart take me to your soul&lt;/p&gt;

&lt;p&gt;Give me your hand and hold me&lt;/p&gt;

&lt;p&gt;Show me what love is - be my guiding star&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s easy take me to your heart&lt;/p&gt;

&lt;p&gt;Take me to your heart take me to your soul&lt;/p&gt;

&lt;p&gt;Give me your hand and hold me&lt;/p&gt;

&lt;p&gt;Show me what love is - be my guiding star&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s easy take me to your heart&lt;/p&gt;

&lt;p&gt;(Chorus)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>自由度和方差分析</title>
      <link>/post/df-and-anova/</link>
      <pubDate>Fri, 08 Dec 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/df-and-anova/</guid>
      <description>&lt;p&gt;比较同一处理不同水平的差异，譬如不同养殖密度、不同饲料对生长速度的影响，经常会用到方差分析的方法。而在方差分析中，自由度是一个非常重要的概念。这篇博客记录对这两个概念的理解。&lt;/p&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. 自由度&lt;/h2&gt;
&lt;p&gt;自由度（Degrees of freedom）是统计学上最经常见到的一个概念。关于它的概念，第一次接触，理解起来有些困难。维基百科的&lt;a href=&#34;https://en.wikipedia.org/wiki/Degrees_of_freedom_(statistics)&#34;&gt;解释&lt;/a&gt;是这样的: “In statistics, the number of degrees of freedom is the number of values in the final calculation of a statistic that are free to vary”。试着翻译：“在统计学中，自由度的个数被定义为，在一个统计参数的计算过程中，可以&lt;strong&gt;自由变化的数值的个数&lt;/strong&gt;”。&lt;/p&gt;
&lt;p&gt;维基百科中，以方差为例，试着给出自由度的计算方法。&lt;/p&gt;
&lt;p&gt;In general, the degrees of freedom of an estimate of a parameter are equal to the number of independent scores that go into the estimate minus the number of parameters used as intermediate steps in the estimation of the parameter itself (e.g. the sample variance has N − 1 degrees of freedom, since it is computed from N random scores minus the only 1 parameter estimated as intermediate step, which is the sample mean).&lt;/p&gt;
&lt;p&gt;翻译：一般来讲，一个参数估计值的自由度等于， 在估计过程中使用的独立样本（score）个数，减掉中间步骤中用到的参数个数。以方差为例，它的自由度为N-1，是因为计算方需要n个独立样本值，而在中间计算过程中用到了样本均值这个参数，所以自由度为n-1。&lt;/p&gt;
&lt;p&gt;方差的计算公式：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[Var(Y) =\frac{\sum_{i=1}^{n} (y_{i}-\bar{y})^{2}}{n-1}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;结合百度百科关于&lt;a href=&#34;https://baike.baidu.com/item/%E8%87%AA%E7%94%B1%E5%BA%A6/5936984?fr=aladdin&#34;&gt;方差自由度&lt;/a&gt;的解释，感觉可以这样理解：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先，在估计总体的平均数时，由于样本中的 n 个数都是相互独立的，从其中抽出任何一个数都不影响其他数据，所以其自由度为n。&lt;/li&gt;
&lt;li&gt;在估计总体的方差时，使用的是离差平方和。&lt;strong&gt;由上面的公式可知，计算方差需要首先获得n个数的平均值。一旦平均数确定了，那么在计算方差时，只要n-1个数的离差平方和确定了，方差也就确定了；因为在均值确定后，如果知道了其中n-1个数的值，第n个数的值也就确定了&lt;/strong&gt;。这里，均值就相当于一个限制条件，由于加了这个限制条件，估计总体方差的自由度为n-1。&lt;/li&gt;
&lt;li&gt;例如，我们有5尾虾的体重数据（n=5），想估计其方差。计算得到5尾虾的平均值为&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;=20g，那么方差就会即受到&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;=20g的条件限制。因为随机选择4尾虾18g、22g、23g、17g计算得到离差平方和后，第5尾虾的体重，根据均值可以算出来，它的离差平方和也就确定了。因而自由度df=n-1=5-1=4，这表示&lt;strong&gt;第5尾虾的离差是依赖平均数&lt;/strong&gt;，受到平均数限制的。推而广之，任何统计量的自由度df=n-k（k为限制条件的个数）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;知乎上关于&lt;a href=&#34;https://www.zhihu.com/question/20983193&#34;&gt;自由度&lt;/a&gt;的解释非常专业，建议前往理解和学习，有一些非常难以理解。答主&lt;a href=&#34;https://www.zhihu.com/people/SigmaWang&#34;&gt;Wang Sigma&lt;/a&gt;的一句话，是我能够理解的“本质上，&lt;strong&gt;自由度是做一个估计（推测）时，所拥有的独立信息（证据）的数量&lt;/strong&gt;”。&lt;/p&gt;
&lt;p&gt;方差分析，需要用到自由度，下边结合方差分析，来研究自由度的变化。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;analysis-of-varianceanova&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;2. 方差分析（analysis of variance，ANOVA）&lt;/h2&gt;
&lt;p&gt;在育种工作中，我们经常会通过各种试验来分析不同的因素对试验结果的影响。譬如设计实验，分析不同养殖密度、不同饲料种类对生长速度的影响，找出最好的那个水平。&lt;/p&gt;
&lt;p&gt;ANOVA分析，可以用来实现上述目的。主要是用来检测分类变量的效应，也就是我们在线性混合效应模型中常说的固定效应。譬如不同性别、不同群体的差异。&lt;/p&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;2.1 生成数据&lt;/h3&gt;
&lt;p&gt;我们同样以对虾为例，生成投喂四种饲料后的体重数据。饲料种类称为一个处理，每种饲料是一个水平。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(data.table)
require(ggplot2)
feed.1 &amp;lt;- rnorm(n=100,mean = 25,sd = 6)
feed.2 &amp;lt;- rnorm(n=100,mean = 20,sd = 6)
feed.3 &amp;lt;- rnorm(n=100,mean = 15,sd = 6)
feed.4 &amp;lt;- rnorm(n=100,mean = 10,sd = 6)

feed &amp;lt;- data.table(F1=feed.1,F2=feed.2,F3=feed.3,F4=feed.4)
feed.new &amp;lt;- melt(feed,measure.vars = 1:4)
setnames(feed.new,colnames(feed.new),c(&amp;quot;Feed&amp;quot;,&amp;quot;Weight&amp;quot;))

ggplot(data=feed.new,aes(x=Feed,y=Weight,color=Feed)) + 
  geom_boxplot(outlier.size = 0)+
  geom_jitter(alpha=0.3)+
  labs(x=&amp;quot;饲料种类&amp;quot;,y=&amp;quot;体重&amp;quot;)+
  theme_gray(base_size = 20)+
  theme(legend.position = &amp;quot;none&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:generate&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-12-08-df-and-anova_files/figure-html/generate-1.png&#34; alt=&#34;投喂不同饲料种类后对虾体重分布箱形图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: 投喂不同饲料种类后对虾体重分布箱形图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;通过上图，从体重均值上可以看出，四种饲料间存在差别。但是，我们需要回答以下几个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这种差异有没有偶然因素？从上图中可以看出，每种饲料试验虾的体重都存在较大的变异范围。&lt;/li&gt;
&lt;li&gt;样本量和实验设计是否满足要求？&lt;/li&gt;
&lt;li&gt;结果可靠吗？如何对结果的可靠性进行检验？&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;2.2 方差分析的基本概念&lt;/h3&gt;
&lt;p&gt;这就需要统计学手段帮我们回答。&lt;/p&gt;
&lt;p&gt;首先我们设定一个无效假设：四种饲料投喂对虾后，体重均值相等，没有差异。&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[H_{0}: \mu_{1} = \mu_{2} = \mu_{3} = \mu_{4}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;然后建立数学模型，检验&lt;span class=&#34;math inline&#34;&gt;\(\mu_{i}\)&lt;/span&gt;间的差异程度。如果各水平间差异显著，那么就会得出备择假设：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(H_{1}: \mu_{1}, \mu_{2}, \mu_{3}, \mu_{4}\)&lt;/span&gt;不全相等。&lt;/p&gt;
&lt;p&gt;我们以单因素方差分析(one-way ANOVA）为例，建立分析不同饲料投喂后体重差异的数学模型：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
\left\{\begin{matrix}
y_{ij} = \mu + \alpha_{i} + \varepsilon_{ij} \\ 
\varepsilon_{ij} \sim N(0,\sigma^{2}) \\ 
\sum_{i=1}^{r}n\alpha_{i} = 0
\end{matrix}\right.
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上边公式中i=1, 2,…,4，表示饲料种类；&lt;span class=&#34;math inline&#34;&gt;\(y_{ij}\)&lt;/span&gt;表示投喂第i种饲料后第j尾对虾的体重；&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;为总体均值；&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(\alpha_{i}\)&lt;/span&gt;表示第i种饲料的固定效应，&lt;span class=&#34;math inline&#34;&gt;\(\alpha_{i} = \mu_{i} - \mu\)&lt;/span&gt;，其中&lt;span class=&#34;math inline&#34;&gt;\(\mu_{i}\)&lt;/span&gt;是第i种饲料的均值；&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon_{ij}\)&lt;/span&gt;表示残差，它符合正态分布：均值为0，方差为&lt;span class=&#34;math inline&#34;&gt;\(\sigma^{2}\)&lt;/span&gt;；&lt;/p&gt;
&lt;p&gt;要想满足&lt;span class=&#34;math inline&#34;&gt;\(\sum_{i=1}^{r}n\alpha_{i} = 0\)&lt;/span&gt;这个条件，每个水平下的样本数都应该是一致的。其中r=4，表示四种饲料；n表示每种饲料水平参与测试的样本数。&lt;/p&gt;
&lt;p&gt;上述公式表明：如果要对数据进行方差分析，要满足3个基本条件（从线性模型角度看，这三个基本条件非常容易理解）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可加性。主要是指处理效应&lt;span class=&#34;math inline&#34;&gt;\(\alpha_{i}\)&lt;/span&gt;与残差&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon_{ij}\)&lt;/span&gt;效应是独立的，因此可以加在一起；&lt;/li&gt;
&lt;li&gt;独立正态性。指的是实验误差&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon_{ij}\)&lt;/span&gt;应当符合正态分布，而且相互间独立；&lt;/li&gt;
&lt;li&gt;方差齐性。主要指的是不同处理的方差应该是一致的。也就是说，需要满足假设“&lt;span class=&#34;math inline&#34;&gt;\(\sigma^{2}_{1} = \sigma^{2}_{2} = ... = \sigma^{2}_{r}\)&lt;/span&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;2.3 总变异的剖分&lt;/h3&gt;
&lt;p&gt;下边我们进入正题。如何比较处理间的差异？ANOVA的思路是把测量数据的总变异分解为由处理各水平引起的变异和误差变异两部分，然后比较这两部分的大小，通过F检验确定由处理产生的变异是否达到显著水平。&lt;/p&gt;
&lt;p&gt;为了检验&lt;span class=&#34;math inline&#34;&gt;\(H_{0}\)&lt;/span&gt;假设，对平方和、自由度进行分解：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(S_{T} = \sum_{i=1}^{r}\sum_{j=1}^{n_{i}}(y_{ij}-\bar{y_{\cdot\cdot}})^{2}\)&lt;/span&gt;，&lt;span class=&#34;math inline&#34;&gt;\(\bar{y} = \frac{1}{n}\sum_{i=1}^{r}\sum_{j=1}^{n_{i}}y_{ij}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(S_{T}\)&lt;/span&gt;称为总离差平方和，是每个样本数据&lt;span class=&#34;math inline&#34;&gt;\(y_{ij}\)&lt;/span&gt;与总体均值&lt;span class=&#34;math inline&#34;&gt;\(\bar{y_{\cdot\cdot}}\)&lt;/span&gt;差的平方和。实际上描绘了总体数据的离散程度。&lt;/p&gt;
&lt;p&gt;总离差平方和可以进一步分解为处理平方和、误差平方和：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[S_{T} = S_{A} + S_{E}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中处理平方和：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
S_{A} = \sum_{i=1}^{r}\sum_{j=1}^{n}(y_{i\cdot}-\bar{y_{\cdot\cdot}})^{2} \\
 =  n\sum_{i=1}^{r}(y_{i\cdot}-\bar{y_{\cdot\cdot}})^{2}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;误差平方和：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[S_{E} = \sum_{i=1}^{r}\sum_{j=1}^{n}(y_{ij}-\bar{y_{i\cdot}})^{2}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;推导过程： &lt;span class=&#34;math display&#34;&gt;\[
S_{T} =  \sum_{i=1}^{r}\sum_{j=1}^{n}(y_{ij}-\bar{y_{\cdot\cdot}})^{2} \\
= \sum_{i=1}^{r}\sum_{j=1}^{n}[(y_{ij}-\bar{y_{i\cdot}})+(\bar{y_{i\cdot}}-\bar{y_{\cdot\cdot}})]^{2} \\
= \sum_{i=1}^{r}\sum_{j=1}^{n}(y_{ij}-\bar{y_{i\cdot}})^2+2\sum_{i=1}^{r}\sum_{j=1}^{n}(y_{ij}-\bar{y_{i\cdot}})(\bar{y_{i\cdot}}-\bar{y_{\cdot\cdot}})+\sum_{i=1}^{r}\sum_{j=1}^{n}(\bar{y_{i\cdot}}-\bar{y_{\cdot\cdot}})^{2} 
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;由于上边公式中，中间部分为0，因此可以直接推导出：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
S_{T} = \sum_{i=1}^{r}\sum_{j=1}^{n}(y_{ij}-\bar{y_{i\cdot}})^2+\sum_{i=1}^{r}\sum_{j=1}^{n}(\bar{y_{i\cdot}}-\bar{y_{\cdot\cdot}})^{2}  \\
 = S_{E} + S_{A}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;下边结合第一部分自由度的基础概念，来推导&lt;span class=&#34;math inline&#34;&gt;\(S_{T}\)&lt;/span&gt;、&lt;span class=&#34;math inline&#34;&gt;\(S_{A}\)&lt;/span&gt;、&lt;span class=&#34;math inline&#34;&gt;\(S_{E}\)&lt;/span&gt;的自由度。&lt;/p&gt;
&lt;p&gt;对于&lt;span class=&#34;math inline&#34;&gt;\(S_{T}\)&lt;/span&gt;，有rn个样本，根据公式只受总体均值的约束，因此自由度为&lt;span class=&#34;math inline&#34;&gt;\(df_{T}=rn-1\)&lt;/span&gt;；&lt;/p&gt;
&lt;p&gt;对于&lt;span class=&#34;math inline&#34;&gt;\(S_{A}\)&lt;/span&gt;，有r个水平，根据公式只受总体均值的约束，因此自由度为&lt;span class=&#34;math inline&#34;&gt;\(df_{A}=r-1\)&lt;/span&gt;；&lt;/p&gt;
&lt;p&gt;对于&lt;span class=&#34;math inline&#34;&gt;\(S_{E}\)&lt;/span&gt;，查看它的公式，可以推出，对于处理的每个水平，受各自均值的约束，自由度为n-1，因此r个处理的自由度为&lt;span class=&#34;math inline&#34;&gt;\(df_{E} = r(n-1)\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;计算自由度的目的是什么？&lt;/strong&gt;有什么用？下边在计算均方时，检验变异的显著性时将会用到。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>线性混合效应模型教程2</title>
      <link>/post/lmm-tutorial-2/</link>
      <pubDate>Wed, 29 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/lmm-tutorial-2/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://luansheng.netlify.com/post/lmm-tutorial-1/&#34;&gt;上接线性混合效应模型教程1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本部分可能会用到的R包，请提前安装：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ggplot2 #优秀的作图包&lt;/li&gt;
&lt;li&gt;data.table #优秀的数据转换处理包&lt;/li&gt;
&lt;li&gt;lme4 #提供lmer函数，进行lmm分析&lt;/li&gt;
&lt;li&gt;lmerTest #提供anova函数，对固定效应进行显著性检验&lt;/li&gt;
&lt;li&gt;sjPlot #lmm结果的可视化展示&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;4.4 包括随机效应的线性混合效应模型&lt;/h3&gt;
&lt;p&gt;请加载一个新的数据集&lt;a href=&#34;https://luansheng.netlify.com/post/shrimpex.csv&#34;&gt;shrimpex.csv&lt;/a&gt;，其中有一个PopID字段，包括Pop1到Pop4共计4个水平，表示shrimp数据由四个群体组成。现在考虑这样一个问题：四个群体间收获体重是否存在差异。&lt;/p&gt;
&lt;p&gt;首先加载数据文件。画出四个群体收获体重的箱形图，加上jitter点。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp &amp;lt;- fread(input = &amp;quot;shrimpex.csv&amp;quot;,sep = &amp;quot;,&amp;quot;,header = TRUE,stringsAsFactors = TRUE)
str(shrimp)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Classes &amp;#39;data.table&amp;#39; and &amp;#39;data.frame&amp;#39;:   4282 obs. of  10 variables:
##  $ AnimalID: Factor w/ 4282 levels &amp;quot;13G1000001&amp;quot;,&amp;quot;13G1000002&amp;quot;,..: 3308 3307 2215 1303 3601 2184 2194 2175 1585 2176 ...
##  $ SireID  : Factor w/ 100 levels &amp;quot;12G000K010&amp;quot;,&amp;quot;12G000K065&amp;quot;,..: 81 81 81 81 81 81 81 81 81 81 ...
##  $ DamID   : Factor w/ 91 levels &amp;quot;12G000K052&amp;quot;,&amp;quot;12G000K097&amp;quot;,..: 81 81 81 81 81 81 81 81 81 81 ...
##  $ PopID   : Factor w/ 4 levels &amp;quot;Pop1&amp;quot;,&amp;quot;Pop2&amp;quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ FamilyID: Factor w/ 105 levels &amp;quot;13F1306003&amp;quot;,&amp;quot;13F1306004&amp;quot;,..: 6 6 6 6 6 6 6 6 6 6 ...
##  $ SexID   : Factor w/ 2 levels &amp;quot;Female&amp;quot;,&amp;quot;Male&amp;quot;: 2 2 1 1 1 2 1 2 2 1 ...
##  $ TankID  : Factor w/ 2 levels &amp;quot;T1&amp;quot;,&amp;quot;T2&amp;quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ M1BW    : num  8.13 8.13 8.13 8.13 8.13 8.55 8.55 8.55 8.55 8.55 ...
##  $ M2BW    : num  29 30.5 33.3 40.1 43 29.1 30.7 30.7 32.5 35.6 ...
##  $ M2Age   : int  219 219 219 219 219 219 219 219 219 219 ...
##  - attr(*, &amp;quot;.internal.selfref&amp;quot;)=&amp;lt;externalptr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data=shrimp,aes(x=PopID,y=M2BW,color=PopID)) + 
  geom_boxplot(outlier.size = 0)+
  geom_jitter(alpha=0.3)+
  labs(x=&amp;quot;群体&amp;quot;,y=&amp;quot;收获体重&amp;quot;)+
  theme_gray(base_size = 20)+
  theme(legend.position = &amp;quot;none&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:popbw&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-12-09-lmm-tutorial-2_files/figure-html/popbw-1.png&#34; alt=&#34;四个对虾群体收获体重的箱形图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: 四个对虾群体收获体重的箱形图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;从上图中，大致可以看出，群体间是存在差异的。&lt;/p&gt;
&lt;p&gt;进一步分析数据，你会发现每个群体由多个家系组成，见下图。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data=shrimp,aes(x=PopID,y=M2BW,fill=FamilyID)) + 
  geom_boxplot(outlier.size = 0)+
  labs(x=&amp;quot;群体&amp;quot;,y=&amp;quot;收获体重&amp;quot;)+
  theme_gray(base_size = 20)+
  theme(legend.position = &amp;quot;none&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:popfamilybw&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-12-09-lmm-tutorial-2_files/figure-html/popfamilybw-1.png&#34; alt=&#34;四个对虾群体内家系收获体重的箱形图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: 四个对虾群体内家系收获体重的箱形图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;这里遇到了一个问题，在评价群体间的差异时，是否需要考虑每个群体内的家系结构？&lt;/p&gt;
&lt;p&gt;理论上，我们从每个群体抽样时，抽样个体是代表该群体的随机样本。但是，一个群体内的个体往往存在亲缘关系，譬如（全同胞、半同胞个体）。因此抽样个体存在两个层次：每个群体包括多个家系，每个家系包括数量不等的个体。&lt;/p&gt;
&lt;p&gt;从上图中可以看出，每个群体内的不同家系间是存在差异的。&lt;/p&gt;
&lt;p&gt;每一个家系内的个体，遗传自同一对亲本，相互间相似性更强。不同家系个体的体重均值是不一样的。&lt;/p&gt;
&lt;p&gt;这实际上&lt;strong&gt;违背了样本观察值的独立性原则&lt;/strong&gt;，同一个家系内的全同胞个体的体重值实际上是由他们亲本所决定。&lt;/p&gt;
&lt;p&gt;针对这种情况，我们把家系效应作为随机效应加入模型中。这相当于，给每个家系设置一个基线，类似于不同的家系有不同的平均体重，也称作&lt;strong&gt;随机截距（random intercept）&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;在模型中加入家系随机效应，那么观察值的非独立性问题就解决了。&lt;/p&gt;
&lt;p&gt;为了说明家系结构对分析结果的影响，故意在每个群体中设置了一个均值特别高的家系。在实际测试数据中，这种现象也会经常出现。如果我们分析时不考虑群体内的家系结构，那么家系方差会被累加到残差方差中。&lt;/p&gt;
&lt;p&gt;如果采取方差分析的方法，你也会发现，忽略家系结构，群体的均方值可能会&lt;strong&gt;非常大，被严重高估&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;根据教程1对于固定效应和随机效应的讨论，由于我们的目的是要分析四个群体间的差异，获得每个群体的性能，因此群体更适合做固定效应。每个群体是由多个家系组成的，这些家系只是大量家系的一个随机抽样，因此更加适合作为随机效应。&lt;/p&gt;
&lt;p&gt;下边我们通过两个模型实例，来看一下家系结构对分析结果的影响。&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;8&#34;&gt;模型8&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Pop + Sex + Tank + Sex:M1BW\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;#8&#34;&gt;模型8&lt;/a&gt;不考虑家系结构，Pop、Sex和Tank为固定效应，Sex:M1BW为协变量。&lt;/p&gt;
&lt;p&gt;分析结果如下：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.8 &amp;lt;- lm(M2BW ~ 1 + PopID + SexID + TankID + SexID:M1BW,shrimp)
summary(shrimp.lm.8) #加载lmerTest包后，lmer的返回结果，每个固定效应系数带有P值&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ 1 + PopID + SexID + TankID + SexID:M1BW, 
##     data = shrimp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -20.7242  -2.5787  -0.2092   2.2353  18.9070 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)      35.42932    0.53924  65.702  &amp;lt; 2e-16 ***
## PopIDPop2        -1.61211    0.18406  -8.759  &amp;lt; 2e-16 ***
## PopIDPop3        -3.61817    0.18086 -20.005  &amp;lt; 2e-16 ***
## PopIDPop4        -5.76930    0.21237 -27.166  &amp;lt; 2e-16 ***
## SexIDMale        -5.39346    0.70557  -7.644 2.59e-14 ***
## TankIDT2         -2.93073    0.13206 -22.192  &amp;lt; 2e-16 ***
## SexIDFemale:M1BW  0.40396    0.06778   5.960 2.73e-09 ***
## SexIDMale:M1BW    0.30223    0.07363   4.105 4.13e-05 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 4.296 on 4233 degrees of freedom
##   (41 observations deleted due to missingness)
## Multiple R-squared:  0.4845, Adjusted R-squared:  0.4837 
## F-statistic: 568.4 on 7 and 4233 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;anova(shrimp.lm.8) #lmerTest包提供该函数&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Analysis of Variance Table
## 
## Response: M2BW
##              Df Sum Sq Mean Sq  F value    Pr(&amp;gt;F)    
## PopID         3  23856    7952  430.856 &amp;lt; 2.2e-16 ***
## SexID         1  39588   39588 2144.973 &amp;lt; 2.2e-16 ***
## TankID        1   9106    9106  493.407 &amp;lt; 2.2e-16 ***
## SexID:M1BW    2    889     445   24.095 3.934e-11 ***
## Residuals  4233  78124      18                       
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a id=&#34;9&#34;&gt;模型9&lt;/a&gt;考虑家系结构，Pop:Family为随机效应，Pop、Sex和Tank为固定效应，Sex:M1BW为协变量。&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Pop + Sex + Tank + Sex:M1BW + Pop:Family\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在模型中加入随机效应，需要使用lme4包中的lmer函数。下边代码中的(1|PopID:FamilyID)，表示针对不同的家系，单独估计其随机截距（random intercept）。其中1表示随机截距。&lt;/p&gt;
&lt;p&gt;分析结果如下：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.9 &amp;lt;- lmer(M2BW ~ 1 + PopID + SexID + TankID + SexID:M1BW  + (1|PopID:FamilyID),shrimp)
summary(shrimp.lm.9)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Linear mixed model fit by REML t-tests use Satterthwaite approximations
##   to degrees of freedom [lmerMod]
## Formula: 
## M2BW ~ 1 + PopID + SexID + TankID + SexID:M1BW + (1 | PopID:FamilyID)
##    Data: shrimp
## 
## REML criterion at convergence: 23070.4
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.5304 -0.5854  0.0240  0.6388  3.8977 
## 
## Random effects:
##  Groups         Name        Variance Std.Dev.
##  PopID:FamilyID (Intercept)  5.933   2.436   
##  Residual                   12.527   3.539   
## Number of obs: 4241, groups:  PopID:FamilyID, 105
## 
## Fixed effects:
##                   Estimate Std. Error        df t value Pr(&amp;gt;|t|)    
## (Intercept)        35.7188     1.0605  487.0000  33.683  &amp;lt; 2e-16 ***
## PopIDPop2          -1.6596     0.6884  101.0000  -2.411  0.01774 *  
## PopIDPop3          -3.7742     0.6733  102.0000  -5.606 1.78e-07 ***
## PopIDPop4          -5.8638     0.7359  111.0000  -7.968 1.58e-12 ***
## SexIDMale          -5.6599     0.5901 4148.0000  -9.591  &amp;lt; 2e-16 ***
## TankIDT2           -2.9491     0.1097 4140.0000 -26.884  &amp;lt; 2e-16 ***
## SexIDFemale:M1BW    0.3757     0.1204  993.0000   3.122  0.00185 ** 
## SexIDMale:M1BW      0.2904     0.1231 1068.0000   2.360  0.01847 *  
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) PpIDP2 PpIDP3 PpIDP4 SxIDMl TnIDT2 SIDF:M
## PopIDPop2   -0.384                                          
## PopIDPop3   -0.419  0.506                                   
## PopIDPop4   -0.519  0.476  0.494                            
## SexIDMale   -0.248  0.002  0.007 -0.004                     
## TankIDT2    -0.042 -0.006 -0.004 -0.001 -0.030              
## SxIDFm:M1BW -0.889  0.077  0.108  0.250  0.291 -0.010       
## SxIDMl:M1BW -0.711  0.074  0.100  0.246 -0.352  0.010  0.786&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;anova(shrimp.lm.9)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Analysis of Variance Table of type III  with  Satterthwaite 
## approximation for degrees of freedom
##            Sum Sq Mean Sq NumDF  DenDF F.value    Pr(&amp;gt;F)    
## PopID       914.2   304.7     3  103.8   24.33  5.33e-12 ***
## SexID      1152.4  1152.4     1 4148.3   92.00 &amp;lt; 2.2e-16 ***
## TankID     9053.7  9053.7     1 4140.1  722.75 &amp;lt; 2.2e-16 ***
## SexID:M1BW  122.4    61.2     2 1414.2    4.88  0.007695 ** 
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;把&lt;a href=&#34;#8&#34;&gt;模型8&lt;/a&gt;的Residual standard error的平方，与&lt;a href=&#34;#9&#34;&gt;模型9&lt;/a&gt; Random Effects部分对比，你会发现，如果不考虑家系结构，残差方差明显被高估,估计值为18.4559804 。考虑家系结构后，残差方差为12.5267428, 明显变小， 从残差中分离出了大部分的家系方差。由家系随机效应产生的方差，估计值为5.9328256，占表型方差的32%。&lt;/p&gt;
&lt;p&gt;从anova方差分析(如果对基础概念不了解，可参考这篇blog：&lt;a href=&#34;https://luansheng.netlify.com/post/df-and-anova/&#34;&gt;自由度和方差分析&lt;/a&gt;)的角度看，加入家系随机效应后，群体固定效应（PopID）尽管仍然也达到了显著水平，但是均方和F值明显变小。这表明存在这样一种风险，&lt;strong&gt;如果考虑群体内的家系结构，本来两个群体的差异可能达不到显著水平，但是如果忽视了这种家系结构，两个群体间的差异统计上会表现为显著水平&lt;/strong&gt;，从而误判群体间的实际性能差别。&lt;/p&gt;
&lt;p&gt;我们看一下，基于模型9（不包括家系的随机效应），预测四个群体家系的性能，如下图所示：你会发现，每个群体中特别大的家系效应，已经被剔除掉了。&lt;/p&gt;
&lt;p&gt;ps：拟合值反应的是包括所有固定和随机效应的结果，lmer中通过fitted()函数获得该值。预测值，是可以设定不包括随机效应的，lmer中通过predict()函数获得该值。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.9.predict &amp;lt;- predict(shrimp.lm.9,re.form=NA) #拟合值
shrimp.lm.9.predict.dt &amp;lt;- data.table(ObsSeq =as.integer(names(shrimp.lm.9.predict)),PredictedValue=shrimp.lm.9.predict)
shrimp[,&amp;quot;:=&amp;quot;(ObsSeq=seq(nrow(shrimp)))]
#把拟合值合并到shrimp数据集
shrimp.predicted.value &amp;lt;- merge(shrimp,shrimp.lm.9.predict.dt,by = c(&amp;quot;ObsSeq&amp;quot;),all.y = TRUE)



ggplot(data=shrimp.predicted.value,aes(x=PopID,y=PredictedValue,fill=FamilyID)) + 
  geom_boxplot(outlier.size = 0)+
  labs(x=&amp;quot;群体&amp;quot;,y=&amp;quot;收获体重预测值&amp;quot;)+
  theme_gray(base_size = 20)+
  theme(legend.position = &amp;quot;none&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:lm9fittedvalue&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-12-09-lmm-tutorial-2_files/figure-html/lm9fittedvalue-1.png&#34; alt=&#34;四个对虾群体体重的预测值&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 3: 四个对虾群体体重的预测值
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;4.5 随机效应的显著性检验&lt;/h3&gt;
&lt;p&gt;模型中加入随机效应后，如何检验其显著性？&lt;/p&gt;
&lt;p&gt;一般是通过似然比率检验（Likelihood ratio test, LRT)来实现。lmerTest包中的rand()函数提供该功能。&lt;/p&gt;
&lt;p&gt;首先我们来看一下似然比率检验的结果：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rand(shrimp.lm.9)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Analysis of Random effects Table:
##                Chi.sq Chi.DF p.value    
## PopID:FamilyID   1341      1  &amp;lt;2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;卡方检验表明，&lt;em&gt;p&lt;/em&gt;&amp;lt;0.01，模型中加入PopID:Family随机效应后，对样本数据拟合得更好。&lt;/p&gt;
&lt;p&gt;LRT检验的公式为&lt;span class=&#34;math inline&#34;&gt;\(LR = 2*(lnL1 - lnL2)\)&lt;/span&gt;，其中L1为复杂模型的最大似然值，L2为简单模型的最大似然值。对L1和L2分别取log转换，计算LR值。然后通过卡方检验，确定p值。自由度为复杂模型和简单模型包括的随机效应数之差。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;#9&#34;&gt;模型9&lt;/a&gt;的最大似然值log转换后为：&lt;span class=&#34;math inline&#34;&gt;\(-1.153518\times 10^{4}\)&lt;/span&gt;；&lt;/p&gt;
&lt;p&gt;不包括PopID:Family随机效应的&lt;a href=&#34;#8&#34;&gt;模型8&lt;/a&gt;的logLikelihood值为&lt;span class=&#34;math inline&#34;&gt;\(-1.21958\times 10^{4}\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;lmer函数返回的最大似然值log转换通过lme4包的logLik()函数实现。对于lm函数返回的最大似然值，stats包也有对应的logLik()函数处理。&lt;/p&gt;
&lt;p&gt;似然比率为：LR = 2*(-11535.178901292 - -12195.7957678913) = 1321.23。自由度为1。&lt;/p&gt;
&lt;p&gt;跟直接利用rand()函数获得的卡方值相比略有出入。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;4.5 获得每个群体的性能&lt;/h3&gt;
&lt;p&gt;调用emmeans包中的函数，计算四个群体的估计边际均值(estimated marginal means)，或者说最小二乘均值(least-squares means)。根据边际均值，我们可以对群体的性能进行排序和比较。&lt;/p&gt;
&lt;p&gt;关于emmeans包，请参考日志&lt;a href=&#34;http://luansheng.netlify.com/post/least-squares-means-note-1/&#34;&gt;最小二乘均值的估计模型&lt;/a&gt;。尽管该日志介绍的是lsmeans包，但用法跟emmeans包都是一样的。而且根据作者介绍，在不久的将来，emmeans包要替代lsmeans包。&lt;/p&gt;
&lt;p&gt;注意，安装emmeans还需要pbkrtest包，这个包没有自动安装，需要手动安装。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(emmeans)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的程辑包：emmeans&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## 载入程辑包：&amp;#39;emmeans&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following object is masked from &amp;#39;package:lmerTest&amp;#39;:
## 
##     lsmeans&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm9.rgl &amp;lt;- ref_grid(shrimp.lm.9)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 载入需要的名字空间：pbkrtest&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
## To enable adjustments, set emm_options(pbkrtest.limit = 4241) or larger,
## but be warned that this may result in large computation time and memory use.&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;emmeans(shrimp.lm9.rgl,&amp;quot;PopID&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  PopID   emmean        SE  df asymp.LCL asymp.UCL
##  Pop1  33.83782 0.4853477 Inf  32.88656  34.78909
##  Pop2  32.17826 0.4903717 Inf  31.21715  33.13937
##  Pop3  30.06359 0.4659862 Inf  29.15028  30.97691
##  Pop4  27.97398 0.5373764 Inf  26.92074  29.02722
## 
## Results are averaged over the levels of: SexID, TankID 
## Degrees-of-freedom method: asymptotic 
## Confidence level used: 0.95&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;从上边结果中查找emmean列，可以看到Pop1群体的边际均值最大，这表明四个群体中该群体性能最好。&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>线性混合效应模型教程1</title>
      <link>/post/lmm-tutorial-1/</link>
      <pubDate>Sun, 19 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/lmm-tutorial-1/</guid>
      <description>&lt;p&gt;学习线性混合效应模型（Linear Mixed Effects Model，LMM）最好的方法，是一边学习理论，一边动手实践，这样印象最为深刻。 本文参考了Bodo Winter博士的教程Linear models and linear mixed effects models in R&lt;a href=&#34;http://www.bodowinter.com/tutorial/bw_LME_tutorial1.pdf&#34;&gt;教程1&lt;/a&gt;&lt;a href=&#34;http://www.bodowinter.com/tutorial/bw_LME_tutorial2.pdf&#34;&gt;教程2&lt;/a&gt;的结构。&lt;/p&gt;
&lt;p&gt;本文中，为了便于理解，使用的数据集是来自csv文件&lt;a href=&#34;https://luansheng.netlify.com/post/shrimp.csv&#34;&gt;shrimp&lt;/a&gt;中的对虾育种数据（对原始数据已经进行了变换）。&lt;/p&gt;
&lt;p&gt;推荐使用&lt;a href=&#34;https://www.rstudio.com/products/RStudio/&#34;&gt;Rstudio&lt;/a&gt;来运行&lt;a href=&#34;https://www.r-project.org/&#34;&gt;R&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;本文代码使用了四个包，请提前加载。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;data.table1&lt;/li&gt;
&lt;li&gt;ggplot2&lt;/li&gt;
&lt;li&gt;lme4&lt;/li&gt;
&lt;li&gt;sjPlot&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;加载方法：可以在控制台（console）运行&lt;code&gt;require(data.table)&lt;/code&gt;命令，加载data.table包。其他包加载命令类似。&lt;/p&gt;
&lt;p&gt;初学者提示：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;R代码和shrimp.csv最好保存在同一个路径下，譬如c:&lt;/li&gt;
&lt;li&gt;设置工作路径到c:，&lt;code&gt;setwd(&amp;quot;c:/shrimp&amp;quot;)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1 读取数据文件&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;fread()&lt;/code&gt;函数来自data.table包，特点是对大文件读取速度特别快。建议使用data.table作为数据处理的主力包。&lt;/p&gt;
&lt;p&gt;其中的参数sep表示文件是用逗号分割，header表示数据文件中第一行是列名，stringsAsFactors表示读入的数据，对于字符类型，是否自动处理为因子类型。为了方便后边模型处理，这里设置为因子类型。&lt;/p&gt;
&lt;p&gt;str()函数可以对数据集有一个汇总。从中看可以看出，AnimalID-个体编号，SireID-父本编号，DamID-母本编号，FamilyID-家系编号，SexID-性别，TankID-测试池号等字符类型，已经被设置为因子类型了。M1BW-入池前体重，M2BW-收获体重和M2Age-收获时日龄均为数字变量。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp &amp;lt;- fread(input = &amp;quot;shrimp.csv&amp;quot;,sep = &amp;quot;,&amp;quot;,header = TRUE,stringsAsFactors = TRUE)
str(shrimp)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Classes &amp;#39;data.table&amp;#39; and &amp;#39;data.frame&amp;#39;:   4282 obs. of  10 variables:
##  $ AnimalID: Factor w/ 4282 levels &amp;quot;13G1000001&amp;quot;,&amp;quot;13G1000002&amp;quot;,..: 3308 3307 2215 1303 3601 2184 2194 2175 1585 2176 ...
##  $ SireID  : Factor w/ 100 levels &amp;quot;12G000K010&amp;quot;,&amp;quot;12G000K065&amp;quot;,..: 81 81 81 81 81 81 81 81 81 81 ...
##  $ DamID   : Factor w/ 91 levels &amp;quot;12G000K052&amp;quot;,&amp;quot;12G000K097&amp;quot;,..: 81 81 81 81 81 81 81 81 81 81 ...
##  $ PopID   : Factor w/ 4 levels &amp;quot;Pop1&amp;quot;,&amp;quot;Pop2&amp;quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ FamilyID: Factor w/ 105 levels &amp;quot;13F1306003&amp;quot;,&amp;quot;13F1306004&amp;quot;,..: 6 6 6 6 6 6 6 6 6 6 ...
##  $ SexID   : Factor w/ 2 levels &amp;quot;Female&amp;quot;,&amp;quot;Male&amp;quot;: 2 2 1 1 1 2 1 2 2 1 ...
##  $ TankID  : Factor w/ 2 levels &amp;quot;T1&amp;quot;,&amp;quot;T2&amp;quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ M1BW    : num  8.13 8.13 8.13 8.13 8.13 8.55 8.55 8.55 8.55 8.55 ...
##  $ M2BW    : num  29 30.5 33.3 40.1 43 29.1 30.7 30.7 32.5 35.6 ...
##  $ M2Age   : int  219 219 219 219 219 219 219 219 219 219 ...
##  - attr(*, &amp;quot;.internal.selfref&amp;quot;)=&amp;lt;externalptr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;数据文件准备完毕，我们正式开始学习线性混合效应模型。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;2 引子：线性混合效应模型可以做什么&lt;/h2&gt;
&lt;p&gt;我们从一个简单的问题开始。对虾是有性别的，分雌雄。如果你对对虾没有任何了解，你可能会想知道，雄虾和雌虾的体重差别大吗？&lt;/p&gt;
&lt;p&gt;我们测定了4282尾虾的体重。&lt;/p&gt;
&lt;p&gt;我们首先直观的看一下雌雄虾体重分布点图。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data=shrimp,aes(x=SexID,y=M2BW,color=SexID))+geom_boxplot()+geom_dotplot(binaxis = &amp;quot;y&amp;quot;,stackdir = &amp;quot;center&amp;quot;,position = &amp;quot;dodge&amp;quot;,binwidth = 0.25)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:sexdotplot&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-11-19-lmm-tutorial-1_files/figure-html/sexdotplot-1.png&#34; alt=&#34;雌雄虾体重分布点图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: 雌雄虾体重分布点图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;从图1中可以大体看出，雌虾体重比雄虾高。然后，我们实际计算雌雄虾体重均值，发现雌虾的确比雄虾重。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.sex.m2bw &amp;lt;- shrimp[,mean(M2BW,na.rm=TRUE),by=.(SexID)]
shrimp.sex.m2bw&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##     SexID       V1
## 1:   Male 28.16273
## 2: Female 34.37646&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;我们不禁要问，雌雄虾的这个差别是真实的吗？这是雌雄虾体重真正的差值吗？这个结果有没有偏差？&lt;/p&gt;
&lt;p&gt;分析一下数据，你会发现，雌雄虾分布在2多个测试池中，且来自105个家系，并且每个家系的入池体重是存在差别的。而且你会发现，两个池子的养殖管理水平存在较大差别。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(shrimp,aes(x=TankID,y=M2BW,color=TankID))+geom_boxplot()+geom_dotplot(binaxis = &amp;quot;y&amp;quot;,stackdir = &amp;quot;center&amp;quot;,position = &amp;quot;dodge&amp;quot;,binwidth = 0.3)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:tankdotplot&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-11-19-lmm-tutorial-1_files/figure-html/tankdotplot-1.png&#34; alt=&#34;不同测试池体重分布点图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: 不同测试池体重分布点图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;我们需要去除测试池、家系对雌雄虾体重的影响，准确估计雌雄虾体重。接下来就要用到线性模型了。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;3 线性混合效应模型简介&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;1&#34;&gt;模型1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Sex + \varepsilon\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;表示一尾虾的体重由性别和随机误差决定。其中&lt;span class=&#34;math inline&#34;&gt;\(Sex\)&lt;/span&gt;作为固定效应，&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon\)&lt;/span&gt;作为随机效应。后者表示所有影响体重的不可测量的效应总和，是随机和不可控制的。&lt;/p&gt;
&lt;p&gt;从数据中我们发现，一尾虾的体重还受它所在的测试池和所在家系的影响。因此，这两个效应也需要放到模型中。模型进一步变为：&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;2&#34;&gt;模型2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Sex + Tank +\varepsilon\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;3&#34;&gt;模型3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Sex + Tank + Family +\varepsilon\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;新加入的两个变量，Tank和Family，如果都作为固定效应。那么上述模型称为线性模型。如果Family作为随机效应，那么模型3称为线性混合效应模型（固定效应+随机效应）。&lt;/p&gt;
&lt;p&gt;这里碰到的一个棘手问题是，模型中一个效应到底是作为固定效应，还是随机效应？准确的说，应该是与研究目的相关。&lt;/p&gt;
&lt;p&gt;SAS for Mixed models (Second edition) 手册中对固定效应的定义为：“An effect is called fixed if the levels in the study represent all possible levels of the factor, or at least all levels about which inference is to be made”。可简单地理解为“该效应的所有水平在实验群体中都已经出现”。譬如在本数据集中，性别只有雌、雄两个水平，因此模型中性别一般作为固定效应。再比如，测试投喂5种饲料对对虾体重的影响。由于目的很明确，只是评估这5种饲料的差异，因此饲料应作为固定效应。&lt;/p&gt;
&lt;p&gt;随机效应的定义为：“Factor effects are random if they are used in the study to represent only a sample (ideally, a random sample) of a larger set of potential levels”。可简单地理解为“试验群体出现的该效应的水平只是一个很大水平数中的随机抽样。&lt;/p&gt;
&lt;p&gt;固定效应和随机效应的差别在哪里？“一个效应作为固定效应，还是随机效应，应该依据研究的目的而定”。“a factor is considered random if its levels plausibly represent a larger population with a probability distribution”。如果我们分析一个效应的目的是为了研究它所在的一个具有概率分布的大群体的情况，那么这个效应应该作为随机效应。随机效应有两个特点，a) 它是大群体中的一个样本，b) 它具有概率分布。&lt;/p&gt;
&lt;p&gt;譬如在shrimp数据集中，我们当前的目的是分析雌雄两个性别的体重差异，那么105个家系就是很大家系中的一个小样本，因此作为随机效应更为合适。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;r&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;4 线型混合效应模型R实战分析&lt;/h2&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;4.1 简单线性模型&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;lm()&lt;/code&gt;是R自带的函数。&lt;code&gt;summary()&lt;/code&gt;函数输出shrimp.lm的结果。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm &amp;lt;- lm(M2BW~SexID,shrimp)
shrimp.lm.sum &amp;lt;- summary(shrimp.lm)
shrimp.lm.sum&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ SexID, data = shrimp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -22.9765  -3.1765  -0.0765   3.0235  18.9235 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)  34.3765     0.1082  317.65   &amp;lt;2e-16 ***
## SexIDMale    -6.2137     0.1560  -39.82   &amp;lt;2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 5.101 on 4280 degrees of freedom
## Multiple R-squared:  0.2704, Adjusted R-squared:  0.2702 
## F-statistic:  1586 on 1 and 4280 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在解释上边的结果。首先来看&lt;code&gt;Multiple R-squared:&lt;/code&gt; 0.2703699，它表示模型对总体方差的解释能力。具体意思可以解释为，总体方差中的27.04%，可以由这个模型来解释。&lt;code&gt;Adjusted R-squared&lt;/code&gt;是对&lt;code&gt;Multiple R-squared&lt;/code&gt;的矫正，主要是考虑了固定效应。固定效应越多，该值越低。&lt;/p&gt;
&lt;p&gt;下一个概念是非常的重要，那就是p值。P值是否小于0.05或者0.001，已经成为文章结果是否可靠，是否能够发表的一个重要标志。但是，p值一定程度上就像SCI论文的影响因子，有点滥用的味道。Nature上关于p值的故事:&lt;a href=&#34;http://blog.sciencenet.cn/blog-265205-771680.html&#34;&gt;中文版本&lt;/a&gt;；&lt;a href=&#34;http://www.nature.com/news/scientific-method-statistical-errors-1.14700&#34;&gt;英文版本&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们还本溯源，本质上p值是一个条件概率，它表示&lt;strong&gt;无效假设为真时的概率&lt;/strong&gt;。那什么是无效假设呢？在上文中，无效假设是&lt;strong&gt;“对于体重性状，雌雄虾间没有差异”&lt;/strong&gt;，也就是说雌雄虾体重是相等的。在本文中，p值为&amp;lt;0.001 ，意味着如果”雌雄间没有差异，那么数据基本上不可能是这样“，因为&lt;strong&gt;雌雄间没有差异&lt;/strong&gt;的概率太低！这反过来表明，性别影响了对虾的体重，雌雄虾体重是有差别的，也就是说统计上是显著的。&lt;/p&gt;
&lt;p&gt;需要注意的另外一个问题是，模型所有效应的显著性（最底部）与系数列表单个效应的显著性还是存在差别的。上文中，两个结果是一致的，主要是因为模型中只包括1个固定效应。如果有更多效应，这两个值就不再相等。&lt;/p&gt;
&lt;p&gt;F值是我们应该关注的另外一个参数，表示模型是否显著的一个重要参数。F值可以简单理解为处理方差与误差方差的比值，譬如在上文中，可以理解为性别间体重方差与残差方差的比值，这个值越大，那么表示雌雄间体重差异越大。需要注意，在上文中F值是1928，与两个自由度有关系（性别2-1；误差4281-1）。&lt;/p&gt;
&lt;p&gt;接下来重点讨论系数列表。你会看到SexIDMale，你可能会问，SexID有两个水平，Female去哪里了？Estimates这一列表示的固定效应值到底是什么意思？&lt;/p&gt;
&lt;p&gt;需要注意，系数列表中最后一列p值，表示估计值偏离0的程度。&lt;/p&gt;
&lt;p&gt;首先看一下系数列表中的(Intercept) 项，估计值是34.3764626，是不是感觉很熟悉？它是Female体重的均值。在本文前边我们估计了雌雄体重的均值。&lt;/p&gt;
&lt;p&gt;再看一下SexIDMale的估计值，是-6.2137345。Intercept估计值+SexIDMale估计值=雄虾体重值28.1627282。为什么要用雌虾体重值作为截距？为什么雄虾体重固定效应估计值要表示为与截距，也就是雌虾体重值的差值？&lt;/p&gt;
&lt;p&gt;第一个问题，之所以选择雌虾而不是雄虾作为截距，只是因为Female和Male这两个水平Female根据字母排序在Male前边。&lt;/p&gt;
&lt;p&gt;第二个问题，之所以把雄虾体重固定效应值表示为与截距之差，是为了与协变量等统一起来。为了解释，大家先看图。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sex.bw &amp;lt;- shrimp[,mean(M2BW,na.rm=TRUE),by=.(SexID)]

ggplot(data=shrimp,aes(x=SexID,y=M2BW,color=SexID))+
  geom_dotplot(binaxis = &amp;quot;y&amp;quot;,stackdir = &amp;quot;center&amp;quot;,position = &amp;quot;dodge&amp;quot;,binwidth = 0.25)+
  geom_vline(xintercept = 1)+
  geom_vline(xintercept = 2)+
  geom_hline(yintercept = 33.93992)+
  geom_hline(yintercept = 27.77438)+
  geom_abline(intercept = 40.75,slope=-6.6155)+
  geom_text(x=2.4,y=31.5,label=&amp;quot;-6.6155&amp;quot;)+
  annotate(&amp;quot;segment&amp;quot;,x=2.5,xend=2.5,y=27.77438,yend = 33.93992)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:sexdotplotannotation&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-11-19-lmm-tutorial-1_files/figure-html/sexdotplotannotation-1.png&#34; alt=&#34;雌雄虾体重截距分解&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 3: 雌雄虾体重截距分解
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;因为Female和Male均为因子变量，因此在x轴上可以将Female标准化为0，Male与Female的间距为1，二者体重差值为-6.2137345，那么斜线的斜率可以认为等于-6.2137345。这样就可以很方便的求解或者说预测体重。&lt;/p&gt;
&lt;p&gt;我们可以根据&lt;a href=&#34;#1&#34;&gt;模型1&lt;/a&gt;，预测雌雄虾体重：&lt;/p&gt;
&lt;p&gt;我们随机选取一尾虾，如果是雄虾，那么斜率为-6.2137345，雄虾的预测体重为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(BW = 群体均值 + 雄虾的固定效应\)&lt;/span&gt; = 34.3764626462644 + -6.21373449092449 = 28.1627282&lt;/p&gt;
&lt;p&gt;我们随机选取一尾虾，如果是雌虾，因为截距本身设置为雌虾体重均值，因此斜率为0，雌虾的预测体重为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(BW = 群体均值 + 雌虾的固定效应\)&lt;/span&gt; = 34.3764626462644 + 0*1 = 34.3764626&lt;/p&gt;
&lt;p&gt;我们继续来看一个稍微复杂的例子，在模型中加入TankID效应&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.sex.tank &amp;lt;- lm(M2BW~SexID+TankID,shrimp)
shrimp.lm.sex.tank.sum &amp;lt;- summary(shrimp.lm.sex.tank)
shrimp.lm.sex.tank.sum&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ SexID + TankID, data = shrimp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -21.4916  -3.0478  -0.1697   2.8166  20.4084 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)  35.8560     0.1276  281.10   &amp;lt;2e-16 ***
## SexIDMale    -6.2082     0.1493  -41.58   &amp;lt;2e-16 ***
## TankIDT2     -2.9644     0.1492  -19.87   &amp;lt;2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 4.882 on 4279 degrees of freedom
## Multiple R-squared:  0.332,  Adjusted R-squared:  0.3317 
## F-statistic:  1063 on 2 and 4279 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;从上边模型中可以看出，截距是35.8560193。我们把数据汇总一下：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp[,mean(M2BW,na.rm=TRUE),by=.(SexID,TankID)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##     SexID TankID       V1
## 1:   Male     T1 29.62356
## 2: Female     T1 35.87844
## 3:   Male     T2 26.70756
## 4: Female     T2 32.86907&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;我们发现，模型实际上是把Female.T1这个组合均值设置为截距（群体均值）。Male到Female.T1的斜率为-6.2081881，T2到Female.T1的斜率为-2.9644499；同理，Female到Female.T1的斜率为0，T1到Female.T1的斜率也为0。&lt;/p&gt;
&lt;p&gt;那么，根据&lt;a href=&#34;#2&#34;&gt;模型2&lt;/a&gt;,可以预测雌雄虾体重：&lt;/p&gt;
&lt;p&gt;如果随机从T1池捞取一尾雄虾，它的预测体重为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(BW = 群体均值 + 雄虾的固定效应 + T1池固定效应\)&lt;/span&gt; = 35.856019327243 + -6.2081881124781*1 + 0*1 = 29.6478312&lt;/p&gt;
&lt;p&gt;这个数值跟Male.T1的均值非常接近。&lt;/p&gt;
&lt;p&gt;如果随机从T2池捞取一尾雄虾，它的预测体重为&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(BW = 群体均值 + 雄虾的固定效应 + T2池固定效应\)&lt;/span&gt; = 35.856019327243 + -6.2081881124781*1 + -2.96444990544144*1 = 26.6833813&lt;/p&gt;
&lt;p&gt;这个数值跟Male.T2的均值非常接近。&lt;/p&gt;
&lt;p&gt;如果随机从T2池捞取一尾雌虾，它的预测体重为&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(BW = 群体均值 + 雌虾的固定效应 + T2池固定效应\)&lt;/span&gt; = 35.856019327243 + 0*1 + -2.96444990544144*1 = 32.8915694&lt;/p&gt;
&lt;p&gt;这个数值跟Female.T2的均值非常接近。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;4.2 带协变量的线性模型&lt;/h3&gt;
&lt;p&gt;什么是协变量（covariate)？ wikipedia中是这样解释&lt;a href=&#34;https://en.wikipedia.org/wiki/Covariate&#34;&gt;协变量&lt;/a&gt;的：In statistics, a covariate is a variable that is possibly predictive of the outcome under study. A covariate may be of direct interest or it may be a confounding or interacting variable. The alternative terms explanatory variable, independent variable, or predictor, are used in a regression analysis.&lt;/p&gt;
&lt;p&gt;举个简单例子，我们从每个家系选择选择30尾个体，尾部用VIE颜色标记后，混合养殖在一起，比较每个家系的生长性能。需要考虑的一个问题就是，混合养殖前每个家系的大小，是不一样的。一般，混养前体重越大的家系，混养结束时体重也会越大。我们在分析混养后体重时，需要考虑混养前每个家系体重对它的影响。这个混养前家系体重，就是一个协变量，在回归分析中，也会称为自变量，解释变量。&lt;/p&gt;
&lt;p&gt;计算每个家系的混养后平均收获体重（M2BW）&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.taggingbw.per.family &amp;lt;-  shrimp[,lapply(.SD,mean,na.rm=TRUE),by=.(FamilyID),.SDcols=c(&amp;quot;M1BW&amp;quot;,&amp;quot;M2BW&amp;quot;)]
shrimp.taggingbw.per.family&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##        FamilyID     M1BW     M2BW
##   1: 13F1306014 8.503478 32.73478
##   2: 13F1306015 8.614000 36.00000
##   3: 13F1306016 8.753810 34.89286
##   4: 13F1306019 7.747561 34.25122
##   5: 13F1306022 8.931842 33.66842
##  ---                             
## 101: 13F1306802 7.274138 27.69655
## 102: 13F1367013 5.438571 25.70000
## 103: 13F1367075 5.016250 26.19750
## 104: 13F1367097 6.937500 26.18125
## 105: 13F1367106 9.000222 38.87778&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;绘制出混养前家系初始体重（M1BW）和混养后体重的散点图（M2BW）：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data=shrimp.taggingbw.per.family,aes(x=M1BW,y=M2BW))+
  geom_point()+
  geom_smooth(method = &amp;quot;lm&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:taggingbwbwpoint&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-11-19-lmm-tutorial-1_files/figure-html/taggingbwbwpoint-1.png&#34; alt=&#34;混养前家系初始体重和混养后体重的散点图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 4: 混养前家系初始体重和混养后体重的散点图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;很明显，二者表现为正相关，相关系数为0.39。因此在对比雌雄体重差异时，需要考虑加入M1BW作为协变量，对M2BW进行校正。&lt;/p&gt;
&lt;p&gt;分析下边2个模型：&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;4&#34;&gt;模型4&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = M1BW + \varepsilon\]&lt;/span&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.m1bw &amp;lt;- lm(M2BW ~ M1BW,shrimp)
summary(shrimp.lm.m1bw)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ M1BW, data = shrimp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -20.6953  -4.1186  -0.3901   3.8326  21.3708 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept) 24.47899    0.47668   51.35   &amp;lt;2e-16 ***
## M1BW         0.94848    0.06434   14.74   &amp;lt;2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 5.832 on 4239 degrees of freedom
##   (41 observations deleted due to missingness)
## Multiple R-squared:  0.04876,    Adjusted R-squared:  0.04854 
## F-statistic: 217.3 on 1 and 4239 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;上边实际上是简单的回归分析，系数表中Intercept为24.4789861，表示当M1BW为0时，混养体重M2BW为24.4789861g。实际上初始体重不可能为0。因此这个截距没有实际意义。&lt;/p&gt;
&lt;p&gt;M1BW的系数估计值为0.9484804，表示初始体重每增加1g，混养体重会增加0.9484804g。&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;5&#34;&gt;模型5&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Sex + Sex:M1BW + \varepsilon\]&lt;/span&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.sex.m1bw &amp;lt;- lm(M2BW~SexID+SexID:M1BW,shrimp)
summary(shrimp.lm.sex.m1bw)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ SexID + SexID:M1BW, data = shrimp)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -23.719  -3.078  -0.090   2.846  18.417 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)      27.28624    0.54727  49.858  &amp;lt; 2e-16 ***
## SexIDMale        -5.91782    0.80948  -7.311 3.16e-13 ***
## SexIDFemale:M1BW  0.97548    0.07385  13.208  &amp;lt; 2e-16 ***
## SexIDMale:M1BW    0.93313    0.08053  11.587  &amp;lt; 2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 4.933 on 4237 degrees of freedom
##   (41 observations deleted due to missingness)
## Multiple R-squared:  0.3196, Adjusted R-squared:  0.3191 
## F-statistic: 663.4 on 3 and 4237 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这个模型稍微复杂一些。从系数列表中，针对雌性两个性别，给出了不同的回归系数。这主要是由于雌雄生长速度的差异造成的，后期雌虾生长速要快于雄虾。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data=shrimp,aes(x=M1BW,y=M2BW,color=SexID))+geom_point()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Removed 41 rows containing missing values (geom_point).&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:taggingbwbwpointbysex&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-11-19-lmm-tutorial-1_files/figure-html/taggingbwbwpointbysex-1.png&#34; alt=&#34;雌雄虾混养前家系初始体重和混养后体重的散点图&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 5: 雌雄虾混养前家系初始体重和混养后体重的散点图
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;我们根据&lt;a href=&#34;#5&#34;&gt;模型5&lt;/a&gt;来预测一尾雄虾的体重,假定它的混养前体重为5g，那么它的混养后体重为26.0340769g。&lt;/p&gt;
&lt;p&gt;M2BW = 27.2862423952692 + -5.91782358698496 + 0.933131628220428*5 = 26.0340769g&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;4.3 包括交互效应的线性模型&lt;/h3&gt;
&lt;p&gt;模型已经变的越来越复杂了。我们进一步在&lt;a href=&#34;#5&#34;&gt;模型5&lt;/a&gt;中加入养殖池TankID效应。&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;6&#34;&gt;模型6&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Sex + Tank + Sex:M1BW\]&lt;/span&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.sex.tank.m1bw &amp;lt;- lm(M2BW ~ SexID + TankID + SexID:M1BW,shrimp)
shrimp.lm.sex.tank.m1bw.sum &amp;lt;- summary(shrimp.lm.sex.tank.m1bw)
print(shrimp.lm.sex.tank.m1bw.sum)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ SexID + TankID + SexID:M1BW, data = shrimp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -22.2635  -2.9218  -0.1317   2.7273  19.9333 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)      28.59445    0.52621  54.340  &amp;lt; 2e-16 ***
## SexIDMale        -5.43136    0.77289  -7.027 2.44e-12 ***
## TankIDT2         -2.95103    0.14467 -20.399  &amp;lt; 2e-16 ***
## SexIDFemale:M1BW  0.99876    0.07049  14.168  &amp;lt; 2e-16 ***
## SexIDMale:M1BW    0.88930    0.07689  11.566  &amp;lt; 2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 4.708 on 4236 degrees of freedom
##   (41 observations deleted due to missingness)
## Multiple R-squared:  0.3805, Adjusted R-squared:  0.3799 
## F-statistic: 650.4 on 4 and 4236 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;从Adjusted R-squared参数（0.3798813 vs 0.2701994可以看出，模型6 对数据的解释能力，相比模型1，已经提高了。也就是说根据模型6预测体重，准确性比模型1要高。&lt;/p&gt;
&lt;p&gt;什么是交互效应？Interaction effects represent the combined effects of factors on the dependent measure. When an interaction effect is present, the impact of one factor depends on the level of the other factor。两个效应间相互影响，促进或者制约的关系。&lt;/p&gt;
&lt;p&gt;譬如，我们数据中有Sex和Tank两个固定效应，那么我们可能会想 雌虾会不会在特别偏爱某种环境，譬如在T1池中长得比T2池中大，但是雄虾可能会在T2池中长的比T1池大？因此我们可以在模型中试着加入交互效应。&lt;/p&gt;
&lt;p&gt;&lt;a id=&#34;7&#34;&gt;模型7&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[M2BW = Sex + Tank + Sex:Tank + Sex:M1BW\]&lt;/span&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shrimp.lm.sex.tank.m1bw.interaction &amp;lt;- lm(M2BW ~ SexID + TankID + SexID:TankID + SexID:M1BW,shrimp)
shrimp.lm.sex.tank.m1bw.interaction.sum &amp;lt;- summary(shrimp.lm.sex.tank.m1bw.interaction)
print(shrimp.lm.sex.tank.m1bw.interaction.sum)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = M2BW ~ SexID + TankID + SexID:TankID + SexID:M1BW, 
##     data = shrimp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -22.2039  -2.8961  -0.1335   2.7157  19.9954 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)        28.64805    0.52985  54.068  &amp;lt; 2e-16 ***
## SexIDMale          -5.56393    0.78792  -7.062 1.92e-12 ***
## TankIDT2           -3.07193    0.20104 -15.280  &amp;lt; 2e-16 ***
## SexIDMale:TankIDT2  0.25075    0.28953   0.866    0.387    
## SexIDFemale:M1BW    0.99972    0.07050  14.180  &amp;lt; 2e-16 ***
## SexIDMale:M1BW      0.89123    0.07692  11.586  &amp;lt; 2e-16 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 4.708 on 4235 degrees of freedom
##   (41 observations deleted due to missingness)
## Multiple R-squared:  0.3806, Adjusted R-squared:  0.3798 
## F-statistic: 520.4 on 5 and 4235 DF,  p-value: &amp;lt; 2.2e-16&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;从系数表中，可以看出，相比两个主效应（SexIDMale：-5.563925、TankIDT2：-3.0719274），Sex和Tank的交互效应非常小（0.2507485），p &amp;gt; 0.05，统计检验与0相比，达不到显著水平。Adjusted R-squared: 0.3798447也表明，相比&lt;a href=&#34;#6&#34;&gt;模型6&lt;/a&gt;，&lt;a href=&#34;#7&#34;&gt;模型7&lt;/a&gt;的解释能力并没有提高。&lt;/p&gt;
&lt;p&gt;我们图形展示一下模型7固定效应：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_model(shrimp.lm.sex.tank.m1bw.interaction,show.values = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34; style=&#34;text-align: center&#34;&gt;&lt;span id=&#34;fig:lm4plot&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-11-19-lmm-tutorial-1_files/figure-html/lm4plot-1.png&#34; alt=&#34;模型7固定效应图形展示&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 6: 模型7固定效应图形展示
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;不考虑除残差外的随机效应，目前模型6是最优模型。我们根据&lt;a href=&#34;#6&#34;&gt;模型6&lt;/a&gt;，可以回答最初的问题，雌雄体重间差异显著。接下来，我们会考虑在模型中加入随机效应，进入线性混合效应模型部分。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>动物育种值预测中的线性模型学习笔记2</title>
      <link>/post/lmm-for-ebv-prediction-xfa/</link>
      <pubDate>Sat, 11 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/lmm-for-ebv-prediction-xfa/</guid>
      <description>&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;6.4.1 因子分析&lt;/h2&gt;
&lt;p&gt;设定w向量，包括n个变量，w的协方差矩阵为G，w用模型表示为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
w = \mu + \phi c + s
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;是群体均值，c是长度为m的公共因子向量，s是残差效应或特定效应，&lt;span class=&#34;math inline&#34;&gt;\(\phi\)&lt;/span&gt;是n×m阶因子负荷矩阵。FA最为常见的形式，是&lt;span class=&#34;math inline&#34;&gt;\(\phi\)&lt;/span&gt;中的任意两列是正交的(orthogonal)，也就是说&lt;span class=&#34;math inline&#34;&gt;\(\phi_{i}\phi_{j}=0\)&lt;/span&gt;，其中i≠j。c中的公共因子不相关，并且方差为1，&lt;span class=&#34;math inline&#34;&gt;\(var(c)=I\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;w的协方差矩阵，可以分解为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[var(w) = G_{FA}=\phi\phi^{&amp;#39;} + S\]&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>FA和XFA学习笔记</title>
      <link>/post/fa-xfa-note/</link>
      <pubDate>Thu, 09 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/fa-xfa-note/</guid>
      <description>&lt;p&gt;ASReml中有一个XFA方差结构。本文从FA(因子分析)基础入手，做一个有关FA和XFA的学习笔记。目的是，弄清楚在ASReml中如何定义XFA方差结构。以及如何解读生成的方差组分。&lt;/p&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.1 因子分析的基本概念&lt;/h2&gt;
&lt;p&gt;因子分析(factor analysis)是一种数据简化的技术。它通过研究众&lt;strong&gt;多变量&lt;/strong&gt;之间的内部依赖关系（这里指的变量是譬如&lt;strong&gt;体长、体重、头胸甲等性状&lt;/strong&gt;，而不是样品编号），探求观测数据中的&lt;strong&gt;基本结构&lt;/strong&gt;，并用少数几个&lt;strong&gt;基础变量&lt;/strong&gt;（underlying variate）来表示其基本的数据结构。这几个基础变量能够反映原来众多变量的主要信息。原始的变量是可观测的变量，而基础变量是不可观测的潜在变量，称为&lt;strong&gt;因子&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;因子分析实际上是降维的一种方法。&lt;/p&gt;
&lt;p&gt;譬如：在企业形象或品牌形象的研究中，消费者可以通过一个有24个指标构成的评价体系，评价百货商场的24个方面的优劣。但消费者主要关心的是三个方面，即商店的环境、商店的服务和商品的价格。因子分析方法可以通过24个变量，找出反映商店环境、商店服务水平和商品价格的4个公共潜在的因子，对商店进行综合评价。而这4个公共因子可以表示为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
x_{i}=\mu_{i}+\alpha_{i1}F_{1}+\alpha_{i2}F_{2}+\alpha_{i3}F_{3}+\alpha_{i4}F_{4}+\varepsilon_{i}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;下边对上述模型的解释尤为重要,提到了两个非常重要的概念，&lt;strong&gt;公共因子&lt;/strong&gt;和&lt;strong&gt;特殊因子&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;其中，&lt;span class=&#34;math inline&#34;&gt;\(x_{i}\)&lt;/span&gt;表示每个指标（变量），F1，F2，F3和F4表示不可观测的4个公共因子，24个指标（变量）共享这4个因子，每个指标（变量）中不能被共享的部分，称为特殊因子&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon_{i}\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;因子分析与主成分分析的异同（最好有实际的例子展示）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主成分分析: 初始变量的线性组合表示新的综合变量，即主成分；&lt;/li&gt;
&lt;li&gt;因子分析：潜在的基础变量即公共变量和特殊变量的线性组合表示原始变量；&lt;/li&gt;
&lt;li&gt;主成分分析仅仅是变量转换，而因子分析需要构造因子分析模型。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.2 因子分析的数学模型&lt;/h2&gt;
&lt;p&gt;首先来看一个数学模型：&lt;/p&gt;
&lt;p&gt;模型的方式表示为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
X = \mu + AF + \varepsilon
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中X为观测变量矩阵, A为载荷因子矩阵，F为公共因子矩阵，&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon\)&lt;/span&gt;为特殊因子矩阵。&lt;/p&gt;
&lt;p&gt;矩阵形式表示为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
\begin{bmatrix}
x_{1} \\ 
x_{2} \\ 
...   \\
x_{p}
\end{bmatrix} 
= 
\begin{bmatrix}
\mu_{1} \\ 
\mu_{2} \\ 
...     \\
\mu_{p}
\end{bmatrix}
+
\begin{bmatrix}
\alpha_{11} &amp;amp; \alpha_{12} &amp;amp; ... &amp;amp; \alpha_{1m} \\ 
\alpha_{21} &amp;amp; \alpha_{22} &amp;amp; ... &amp;amp; \alpha_{2m} \\ 
\vdots      &amp;amp; \vdots      &amp;amp; \vdots &amp;amp; \vdots   \\ 
\alpha_{p1} &amp;amp; \alpha_{p2} &amp;amp; ... &amp;amp; \alpha_{pm}
\end{bmatrix}
\begin{bmatrix}
F_{1} \\ 
F_{2} \\ 
...   \\
F_{m}
\end{bmatrix}
+
\begin{bmatrix}
\varepsilon_{1} \\ 
\varepsilon_{2} \\ 
...     \\
\varepsilon_{p} 
\end{bmatrix}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上边这个模型中，&lt;span class=&#34;math inline&#34;&gt;\(x_{p}\)&lt;/span&gt;表示第p个可观察的变量，对应到例子中24个指标(p=24)；m表示公共因子的数量，对应到上边的例子，m=4；&lt;span class=&#34;math inline&#34;&gt;\(a_{pm}\)&lt;/span&gt;称为因子载荷矩阵，p行m列，对应到例子为24行4列；&lt;span class=&#34;math inline&#34;&gt;\(\varepsilon_{p}\)&lt;/span&gt;表示特殊因子，对应到例子中24个指标(p=24)。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.3 因子分析模型的一些性质&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;公共因子和特殊因子之间独立，协方差为0，不相关。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
cov(F,\varepsilon) = 0
\]&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;公共因子间不相关，每个因子的方差为1。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
D(F) = 
\begin{bmatrix}
1 &amp;amp;   &amp;amp;   &amp;amp;   \\ 
  &amp;amp; 1 &amp;amp;   &amp;amp;   \\ 
  &amp;amp;   &amp;amp; \ddots &amp;amp;   \\ 
  &amp;amp;   &amp;amp;   &amp;amp; 1
\end{bmatrix}
\]&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特殊因子间不相关，每个因子的方差可以不等。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
D(\varepsilon) = 
\begin{bmatrix}
\sigma^2_{1} &amp;amp;   &amp;amp;   &amp;amp;   \\ 
  &amp;amp; \sigma^2_{2} &amp;amp;   &amp;amp;   \\ 
  &amp;amp;   &amp;amp; \ddots &amp;amp;   \\
  &amp;amp;   &amp;amp;   &amp;amp; \sigma^2_{p} 
\end{bmatrix}
\]&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原始变量协方差结构的分解&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
X - \mu =  AF + \varepsilon
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
Var(X-\mu) = AVar(F)A + Var(\varepsilon) \\
Var(X) = AVar(F)A + Var(\varepsilon)
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上边这个公式非常重要，它表明X的协方差矩阵可以表示用公共因子方差矩阵、载荷系数矩阵和特殊因子矩阵进行表示。这几个矩阵的维度比X的协方差矩阵都要低很多。&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;xfa-extended-factor-analysis-model&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.4 XFA (eXtended Factor Analysis model)&lt;/h2&gt;
&lt;p&gt;XFA实际上是因子分析的一种扩展形式，参见&lt;a href=&#34;https://www.vsni.co.uk/software/asreml/htmlhelp/asreml/facanal.htm&#34;&gt;ASReml的说明文档&lt;/a&gt;：&lt;/p&gt;
&lt;p&gt;譬如xfa1(4)表示，原始变量有4个，公共因子只有1个，载荷系数矩阵为4行×1列，特殊因子为4行×1列。 当时给ASReml作者Arthur Gilmour的邮件中也是这么理解的：&lt;/p&gt;
&lt;p&gt;Now I have known some about XFA and what you have write. XFA1 means that we only use the 1 common factor. I also know the number of parameters will be 8 (the first four values are for special or residual variance, the last four values are the coefficient for 1th common factor ) if I have 4 variables.&lt;/p&gt;
&lt;p&gt;在ASReml中定义方差结构时，如果需要提供先验值，以XFA1(4)为例，那么顺序是：4个特殊因子方差值；然后是载荷系数矩阵第1列（4个数，只有1列），如果是xfa2(4)，那么这里会有8个数（因为有2列）。&lt;/p&gt;
&lt;p&gt;以直接DGE和间接遗传效应IGE方差组分为例，如果有高（HD）和低（LD）2个密度，那么会存在四个变量：LD.DGE、LD.IGE HD.DGE HD.IGE，在ASReml中可以这样定义：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;str(Dens.AnimalID $Mates Zero.Animal xfa1(4).nrm(AnimalID))&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;code&gt;Mates&lt;/code&gt;表示为(实际上是2个密度的IGE)：&lt;/p&gt;
&lt;pre class=&#34;asreml&#34;&gt;&lt;code&gt;!ASSIGN Mates Dens.Mate1 and(Dens.Mate2) and(Dens.Mate3) and(Dens.Mate4) and(Dens.Mate5) and(Dens.Mate6) and(Dens.Mate7) and(Dens.Mate8) and(Dens.Mate9) and(Dens.Mate10) and(Dens.Mate11) and(Dens.Mate12) and(Dens.Mate13) and(Dens.Mate14) and(Dens.Mate15) and(Dens.Mate16) and(Dens.Mate17) and(Dens.Mate18) and(Dens.Mate19) and(Dens.Mate20) and(Dens.Mate21) and(Dens.Mate22) and(Dens.Mate23) and(Dens.Mate24) and(Dens.Mate25) and(Dens.Mate26) and(Dens.Mate27) and(Dens.Mate28) and(Dens.Mate29) and(Dens.Mate30) and(Dens.Mate31) and(Dens.Mate32) and(Dens.Mate33) and(Dens.Mate34) and(Dens.Mate35) and(Dens.Mate36) and(Dens.Mate37) and(Dens.Mate38) and(Dens.Mate39) and(Dens.Mate40) and(Dens.Mate41) and(Dens.Mate42) and(Dens.Mate43) and(Dens.Mate44) and(Dens.Mate45)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中Zero.Animal的意思，咨询ASReml的作者Arthur Gilmour：&lt;/p&gt;
&lt;p&gt;只是说The design matrix for an XFA terms needs extra empty columns to fit the FACTOR.&lt;/p&gt;
&lt;p&gt;ASReml给出的一个结果：&lt;/p&gt;
&lt;pre class=&#34;asreml&#34;&gt;&lt;code&gt;4 XFA_V  0  1  0.257662      0.257662       0.43   0 P  
4 XFA_V  0  2   0.00000       0.00000       0.00   0 F  
4 XFA_V  0  3   0.00000       0.00000       0.00   0 F  
4 XFA_V  0  4  0.676462E-03  0.676462E-03   0.70   0 P  
4 XFA_L  1  1 -0.650819     -0.650819      -1.80   0 P  
4 XFA_L  1  2  0.894162      0.894162       4.18   0 P    
4 XFA_L  1  3  0.468200E-01  0.468200E-01   1.88   0 P  
4 XFA_L  1  4 -0.126477E-01 -0.126477E-01  -0.90   0 P  &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;前边四个值是特殊因子方差，接下来四个值是因子载荷矩阵第1列的四个值。&lt;/p&gt;
&lt;p&gt;ASReml提供了从xfa到us结构的转换方法（在VPREDICT部分）：&lt;/p&gt;
&lt;pre class=&#34;asreml&#34;&gt;&lt;code&gt;VPREDICT !DEFINE
V Gen xfa1(4).nrm(AnimalID) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;转换为us结构后的结果(10个参数，4行×4列下三角)：&lt;/p&gt;
&lt;pre class=&#34;asreml&#34;&gt;&lt;code&gt; AnimalID               NRM   13176
  13 Gen                      0.68124       0.42820        
  14 Gen                     -0.58188       0.33805        
  15 Gen                      0.79961       0.44647        
  16 Gen                     -0.30467E-01   0.28622E-01    
  17 Gen                      0.41867E-01   0.27579E-01
  18 Gen                      0.21921E-02   0.24696E-02
  19 Gen                      0.82304E-02   0.11226E-01
  20 Gen                     -0.11310E-01   0.14198E-01
  21 Gen                     -0.59218E-03   0.78588E-03
  22 Gen                      0.83648E-03   0.10994E-02&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;todo&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;todo&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;因子载荷矩阵，需要详细了解。以及在ASRreml中为什么需要zero。&lt;/li&gt;
&lt;li&gt;关于XFA，在Linear Models for the Prediction of Animal Breeding Values(3nd version)中，有讨论，可以深入看一下。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>data.table学习笔记5</title>
      <link>/post/data-table-note-5/</link>
      <pubDate>Sun, 03 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/data-table-note-5/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;data.table的特点：&lt;strong&gt;减小计算复杂度&lt;/strong&gt;，降低&lt;strong&gt;计算时间&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;div id=&#34;dfdata.framedtdata.table&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;1. 1建立两个数据集：DF（data.frame）和DT（data.table）&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DF = data.frame(x=rep(c(&amp;quot;b&amp;quot;,&amp;quot;a&amp;quot;,&amp;quot;c&amp;quot;),each=3), y=c(1,3,6), v=1:9) #data frame类型数据集
DT = data.table(x=rep(c(&amp;quot;b&amp;quot;,&amp;quot;a&amp;quot;,&amp;quot;c&amp;quot;),each=3), y=c(1,3,6), v=1:9) #data.table类型数据集&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;dfdtidentical&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.2 比较DF和DT,注意函数identical，是比较两个对象的安全方式。&lt;/h2&gt;
&lt;p&gt;DF和DT本质上都是list类型？&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DF&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   x y v
## 1 b 1 1
## 2 b 3 2
## 3 b 6 3
## 4 a 1 4
## 5 a 3 5
## 6 a 6 6
## 7 c 1 7
## 8 c 3 8
## 9 c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: b 3 2
## 3: b 6 3
## 4: a 1 4
## 5: a 3 5
## 6: a 6 6
## 7: c 1 7
## 8: c 3 8
## 9: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;identical(dim(DT),dim(DF)) #比较维数是否相同&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;identical(DF$a,DT$a) #比较a列是否相同&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;is.list(DF) #检测是否是list类型&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;is.list(DT) #同上&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;is.data.frame(DT) #data.table是否是data.frame类型&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tables() #用来统计全局环境中有多少个data.table。&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##      NAME NROW NCOL MB COLS  KEY
## [1,] DT      9    3  1 x,y,v    
## Total: 1MB&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.3 基本数据提取操作&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[2] #提取第2行&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 3 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[3:2] #提取第3行和第2行&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 6 3
## 2: b 3 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[order(x)] #根据x列排序DT数据集&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6
## 4: b 1 1
## 5: b 3 2
## 6: b 6 3
## 7: c 1 7
## 8: c 3 8
## 9: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[order(x),] #同上&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6
## 4: b 1 1
## 5: b 3 2
## 6: b 6 3
## 7: c 1 7
## 8: c 3 8
## 9: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[y&amp;gt;2] #提取y&amp;gt;2的所有数据行&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 3 2
## 2: b 6 3
## 3: a 3 5
## 4: a 6 6
## 5: c 3 8
## 6: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[y&amp;gt;2 &amp;amp; v&amp;gt;5] #提取满足条件y&amp;gt;2 并且v&amp;gt;5的所有数据行&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 6 6
## 2: c 3 8
## 3: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[!2:4] #剔除2,3,4行后的数据集&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: a 3 5
## 3: a 6 6
## 4: c 1 7
## 5: c 3 8
## 6: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[-(2:4)] #同上&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: a 3 5
## 3: a 6 6
## 4: c 1 7
## 5: c 3 8
## 6: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.4 选择列，计算列&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,v] #选择v列返回向量&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 2 3 4 5 6 7 8 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,list(v)] #同上&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    v
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5
## 6: 6
## 7: 7
## 8: 8
## 9: 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,.(v)] #同上，.()等同于list()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    v
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5
## 6: 6
## 7: 7
## 8: 8
## 9: 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,sum(v)] #计算v列的和，返回一个向量&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 45&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,.(sum(v))] #同上，但是返回一个data.table类型，列名V1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    V1
## 1: 45&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,.(sv=sum(v))] #同上，命名为sv&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    sv
## 1: 45&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,.(v,v*2)] #生成一个新的数据集，包括v和v*2两列&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    v V2
## 1: 1  2
## 2: 2  4
## 3: 3  6
## 4: 4  8
## 5: 5 10
## 6: 6 12
## 7: 7 14
## 8: 8 16
## 9: 9 18&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.5 同时筛选行列&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[2:3,sum(v)] #返回一个向量&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 5&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[2:3,.(sum(v))] #返回一个data.table,列命名为V1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    V1
## 1:  5&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[2:3,.(sv=sum(v))] #返回一个data.table，列命名为sv&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    sv
## 1:  5&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[2:5,cat(v,&amp;quot;\n&amp;quot;)] #v列2-5行，通过cat连接输出为一个字符串，不明白为什么有一个NULL&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 2 3 4 5&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## NULL&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;data.frame&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.6 通过data.frame的方式提取数据&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,2,with=FALSE] #提取2列的数据，with参数，控制列是否可以运算&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    y
## 1: 1
## 2: 3
## 3: 6
## 4: 1
## 5: 3
## 6: 6
## 7: 1
## 8: 3
## 9: 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,sum(2),with=FALSE] #with=FALSE，表示列不可运算，返回与上式相同的结果&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    y
## 1: 1
## 2: 3
## 3: 6
## 4: 1
## 5: 3
## 6: 6
## 7: 1
## 8: 3
## 9: 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,sum(v),with=TRUE] #v列之和&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 45&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#DT[,sum(v),with=FALSE] #这种格式错误，不能操作v列
DT[[&amp;quot;v&amp;quot;]] #提取v列更快的方式&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 2 3 4 5 6 7 8 9&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.7 组操作&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,sum(v),by=x] #依据x列分组，求v列和&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: b  6
## 2: a 15
## 3: c 24&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,sum(v),keyby=x] #依据x列分组，求v列和，结果按照x列排序&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: a 15
## 2: b  6
## 3: c 24&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[,sum(v),keyby=x][order(x)] #结果同上，但是链式表达式操作&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: a 15
## 2: b  6
## 3: c 24&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.8 快速数据集提取，二级索引形式&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[&amp;quot;a&amp;quot;,on=&amp;quot;x&amp;quot;] #on开启二级索引形式&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[&amp;quot;a&amp;quot;,on=.(x)] #更加方便的形式，不用写双引号&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;a&amp;quot;),on=.(x)] #作用同上&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[x==&amp;quot;a&amp;quot;] #on 传统形式，然而内部进行了优化，速度同上&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[x!=&amp;quot;b&amp;quot; | y!=3] #没有进行优化&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: b 6 3
## 3: a 1 4
## 4: a 3 5
## 5: a 6 6
## 6: c 1 7
## 7: c 3 8
## 8: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;,3),on=c(&amp;quot;x&amp;quot;,&amp;quot;y&amp;quot;)] #二级索引优化&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 3 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;,3),on=.(x,y)] #二级索引，简化去除引号&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 3 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;,1:2),on=.(x,y)] #不匹配的返回NA&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y  v
## 1: b 1  1
## 2: b 2 NA&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;,1:2),on=.(x,y),nomatch=0] #不匹配的行，不返回&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;,1:2),on=.(x,y),roll=Inf] #不匹配的行，返回前边行对应的值&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: b 2 1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;,1:2),on=.(x,y),roll=-Inf] #不匹配的行，返回后边行对应的值&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: b 2 2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[.(&amp;quot;b&amp;quot;),sum(v*y),on=&amp;quot;x&amp;quot;] #提取x==&amp;quot;b&amp;quot;的行，计算v*y的值，然后求和&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 25&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.9 综合以上所有技能&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[x!=&amp;quot;a&amp;quot;,sum(v),by=x] #对照&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: b  6
## 2: c 24&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[!&amp;quot;a&amp;quot;,sum(v),by=.EACHI,on=&amp;quot;x&amp;quot;] #结果同上，速度更快 .EACHI的意思就是对i中的每一个水平分组分组&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: b  6
## 2: c 24&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[c(&amp;quot;b&amp;quot;,&amp;quot;c&amp;quot;),sum(v),by=.EACHI,on=.(x)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: b  6
## 2: c 24&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.10 合并数据集&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT #原始数据集&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: b 1 1
## 2: b 3 2
## 3: b 6 3
## 4: a 1 4
## 5: a 3 5
## 6: a 6 6
## 7: c 1 7
## 8: c 3 8
## 9: c 6 9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;X = data.table(x=c(&amp;quot;c&amp;quot;,&amp;quot;b&amp;quot;),v=8:7,foo=c(4,2)) #X作为拟要合并的数据集
X&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x v foo
## 1: c 8   4
## 2: b 7   2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;X[DT,on=&amp;quot;x&amp;quot;] #以DT数据集中x列为主，筛选与之匹配的X中的行，left join&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x  v foo y i.v
## 1: b  7   2 1   1
## 2: b  7   2 3   2
## 3: b  7   2 6   3
## 4: a NA  NA 1   4
## 5: a NA  NA 3   5
## 6: a NA  NA 6   6
## 7: c  8   4 1   7
## 8: c  8   4 3   8
## 9: c  8   4 6   9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=&amp;quot;x&amp;quot;] #以X数据集中x列为主，筛选与之匹配的DT行 right join&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.v foo
## 1: c 1 7   8   4
## 2: c 3 8   8   4
## 3: c 6 9   8   4
## 4: b 1 1   7   2
## 5: b 3 2   7   2
## 6: b 6 3   7   2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=&amp;quot;x&amp;quot;,nomatch=0] #返回双方共有的行 inner join&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.v foo
## 1: c 1 7   8   4
## 2: c 3 8   8   4
## 3: c 6 9   8   4
## 4: b 1 1   7   2
## 5: b 3 2   7   2
## 6: b 6 3   7   2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[!X,on=&amp;quot;x&amp;quot;] #返回的是X中没有的DT数据集中的行&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v
## 1: a 1 4
## 2: a 3 5
## 3: a 6 6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=.(y&amp;lt;=foo)] #从此一下的表达式不是特别理解&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.x i.v
## 1: b 4 1   c   8
## 2: a 4 4   c   8
## 3: c 4 7   c   8
## 4: b 4 2   c   8
## 5: a 4 5   c   8
## 6: c 4 8   c   8
## 7: b 2 1   b   7
## 8: a 2 4   b   7
## 9: c 2 7   b   7&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=.(y&amp;gt;=foo)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.x i.v
## 1: b 4 3   c   8
## 2: a 4 6   c   8
## 3: c 4 9   c   8
## 4: b 2 2   b   7
## 5: a 2 5   b   7
## 6: c 2 8   b   7
## 7: b 2 3   b   7
## 8: a 2 6   b   7
## 9: c 2 9   b   7&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=.(x,y&amp;lt;=foo)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.v
## 1: c 4 7   8
## 2: c 4 8   8
## 3: b 2 1   7&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,.(x,y,x.y,v),on=.(x,y&amp;gt;foo)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y x.y v
## 1: c 4   6 9
## 2: b 2   3 2
## 3: b 2   6 3&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=&amp;quot;x&amp;quot;,mult=&amp;quot;first&amp;quot;]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.v foo
## 1: c 1 7   8   4
## 2: b 1 1   7   2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,on=&amp;quot;x&amp;quot;,mult=&amp;quot;last&amp;quot;]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x y v i.v foo
## 1: c 6 9   8   4
## 2: b 6 3   7   2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,sum(v),by=.EACHI,on=&amp;quot;x&amp;quot;]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: c 24
## 2: b  6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,sum(v)*foo,by=.EACHI,on=&amp;quot;x&amp;quot;]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x V1
## 1: c 96
## 2: b 12&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X,sum(v)*i.v,by=.EACHI,on=&amp;quot;x&amp;quot;]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x  V1
## 1: c 192
## 2: b  42&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DT[X, on=.(x, v&amp;gt;=v), sum(y)*foo, by=.EACHI]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x v V1
## 1: c 8 36
## 2: b 7 NA&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>动物育种值预测中的线性模型学习笔记1</title>
      <link>/post/lmm-for-ebv-prediction-note-1/</link>
      <pubDate>Thu, 20 Jul 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/lmm-for-ebv-prediction-note-1/</guid>
      <description>&lt;div id=&#34;-genetic-evaluation-with-different-sources-of-records&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;第一章 基于不同来源记录的遗传评估(Genetic evaluation with different sources of records)&lt;/h1&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.1 介绍&lt;/h2&gt;
&lt;p&gt;育种值预测是大部分为了遗传改良而建立的育种程序不可或缺的一部分。准确地预测育种值，关键是能够获得哪些记录。在一个群体中，开始阶段能够获得的是个体记录，这些个体间可能存在亲缘关系，也可能不存在。在随后的世代中，后代和其他亲缘个体记录也会不断获的。因此，一开始可以用于育种值预测的主要是个体记录，以及少数亲属个体。在本章中，主要讨论利用个体记录以及来自其他亲缘信息预测育种值。此外（also），也讨论了复合不同来源和亲属信息计算选择指数的方法。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.2 基础模型&lt;/h2&gt;
&lt;p&gt;环境和遗传因素决定动物个体的每一个表型观测值。因此可以通过1.1模型对表型观测值进行分解：&lt;/p&gt;
&lt;p&gt;表型观测值=环境效应+遗传效应+残差效应&lt;/p&gt;
&lt;p&gt;用公式书写为：&lt;/p&gt;
&lt;p&gt;模型1.1&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
y_{ij}=\mu_{i}+g_{i}+e_{ij}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;span class=&#34;math inline&#34;&gt;\(y_{ij}\)&lt;/span&gt;表示第&lt;span class=&#34;math inline&#34;&gt;\(i^{th}\)&lt;/span&gt;个体的第j个测定记录；&lt;span class=&#34;math inline&#34;&gt;\(\mu_{i}\)&lt;/span&gt;表示可剖分的非随机环境效应，主要是指固定效应，如窝组、出生年份、性别等；&lt;span class=&#34;math inline&#34;&gt;\(g_{i}\)&lt;/span&gt;是个体i基因型的加性（&lt;span class=&#34;math inline&#34;&gt;\(g_{a}\)&lt;/span&gt;）、显性(&lt;span class=&#34;math inline&#34;&gt;\(g_{d}\)&lt;/span&gt;)和上位epitatic(&lt;span class=&#34;math inline&#34;&gt;\(g_{e}\)&lt;/span&gt;)遗传效应；&lt;span class=&#34;math inline&#34;&gt;\(e_{ij}\)&lt;/span&gt;是影响个体i的随机环境效应之和。&lt;/p&gt;
&lt;p&gt;上文中的加性遗传值（&lt;span class=&#34;math inline&#34;&gt;\(g_{a}\)&lt;/span&gt;），指的是个体来自父本和母本基因的加性效应均值，被称为育种值（breeding value）。*&lt;strong&gt;每个亲本贡献自身基因的一半给它的后代&lt;/strong&gt;。亲本传递给后代的一半基因，其多次抽样的均值，称作该亲本的传递能力（&lt;strong&gt;transmitting ability&lt;/strong&gt;），是该亲本加性遗传值的一半。因此后代育种值等于其双亲传递能力之和。 因为加性遗传值是从亲本传递给子代的基因的函数，它是仅有的可以选择的元素（相对于显性和上位）。显性和上位表示位点内、位点间的交互，通常假定这些效应很少是显著的，一般包括&lt;span class=&#34;math inline&#34;&gt;\(e^{*}_{ij}\)&lt;/span&gt;效应中。因此模型1.1可以改写为：&lt;/p&gt;
&lt;p&gt;模型1.2&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
y_{ij}=\mu+g_{ai}+e^{*}_{ij}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中，&lt;span class=&#34;math inline&#34;&gt;\(e^{*}_{ij}\)&lt;/span&gt;表示随机环境效应、显性和上位遗传值之和。模型1.2形式，适用于动物育种大部分育种值预测问题。通常假定y符合多变量正态分布，这其中的含义表示性状是有无数个加性基因决定，每个基因的效应是相同并且微小的，并且这些基因分布在非连锁位点上，也就是通常说的&lt;strong&gt;微效多基因模型&lt;/strong&gt;（infinitesimal model）。并且，进一步假定y、g和e的方差var(y)、var(g)、&lt;span class=&#34;math inline&#34;&gt;\(var(e^{*}\)&lt;/span&gt;)是已知的,并且配对个体间不存在任何相关（&lt;span class=&#34;math inline&#34;&gt;\(cov(e^{*},e^{*})=0\)&lt;/span&gt;）（不是特别理解）。而且，&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;代表在相同的管理组下所有个体的平均性能，例如在同一个管理系统下，相同的年龄和性别，因此假定&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;也是已知的。那么问题就简单了，从模型1.2中，可以看出，预测育种值的问题，已经简化为&lt;strong&gt;根据剖分出的非随机环境效应调整表型观测值问题，近似等于加权动物个体和他们的亲缘个体的测定记录&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;根据前边的解释，个体i的育种值&lt;span class=&#34;math inline&#34;&gt;\(a_{i}\)&lt;/span&gt;可以进一步剖分：&lt;/p&gt;
&lt;p&gt;公式1.3&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
a_{i}=g_{ai}=\frac{1}{2}a_{s}+\frac{1}{2}a_{d}+m_{i}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;span class=&#34;math inline&#34;&gt;\(a_{s}\)&lt;/span&gt;和&lt;span class=&#34;math inline&#34;&gt;\(a_{d}\)&lt;/span&gt;分别表示父本和母本的育种值，&lt;span class=&#34;math inline&#34;&gt;\(m_{i}\)&lt;/span&gt;是个体i的育种值与双亲育种值均值的偏差，也就是孟德尔抽样(Mendelian sampling)。从遗传上分析（inheritance），孟德尔抽样的本质，是由于每一个亲本仅仅从它的基因库中随机抽取了一半给它的后代（基于染色体的分离和自由组合规律，个体的一半基因，会有很多种组合）。因此，一对父母产生的后代，其基因肯定不会完全相同，他们之间存在着遗传变异。孟德尔抽样，可以理解为，个体来自双亲的加性基因的均值（父母本平均，不是基因平均）与来自双亲的所有可能后代的均值之差。&lt;/p&gt;
&lt;p&gt;在育种程序中，准确地预测育种值是非常重要的。因为在遗传改良过程中，必须要准确地选择那些真正属于高育种值的个体。根据可以用来进行选择的候选个体的类型和可以利用的信息，来决定使用何种预测育种值的方法。下一步讨论，如何利用不同的信息来源预测育种值。在许多遗传评估应用案例中，出现的PTA（predicted tranmitting ability）或者说ETA（estimated transmitting ability），通常指的是预测育种值的一半。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;1.3 利用动物自身性能预测育种值&lt;/h2&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.3.1 单次记录&lt;/h3&gt;
&lt;p&gt;对于个体，当仅可获得一个表型值记录时，个体i的估计育种值计算公式为:&lt;/p&gt;
&lt;p&gt;公式1.4&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[\hat{a}_{i} = b(y_{i}-\mu)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中b是真实育种值对表型性能的回归系数；&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt; 是群体均值，假定&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;是已知的。&lt;/p&gt;
&lt;p&gt;公式1.5&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ b = \frac{cov(a,y)}{var(y)} = \frac{cov(a,a+e)}{var(y)} \\
= \frac{\sigma^2_{a}}{\sigma^2_{y}} \\
= h^2
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;预测值等于调整后的记录值乘以遗传力。选择标准间的相关，在这个例子中是真实育种值与表型值间的相关，也称作预测的准确度。预测准确度，提供了一种评估不同选择标准的方法：相关度越高，选择标准更加适合用来预测育种值。在某些情况下，重复力（repeatability, &lt;span class=&#34;math inline&#34;&gt;\(r^2\)&lt;/span&gt;）也可以作为评估准确性的参数。当个体仅有一个观测值时，准确度计算公式为：&lt;/p&gt;
&lt;p&gt;公式1.6&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
r_{a,y} = cov(a,y)/(\sigma_{a}\sigma_{y}) \\
= \sigma^{2}_{a}/(\sigma_{a}\sigma_{y}) \\
= h
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;准确度为遗传力的开方。选择反应的计算公式（Falconer and Mackay, 1996）为:&lt;/p&gt;
&lt;p&gt;公式1.7&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
R = ir^{2}_{a,y}\sigma_{y} = ih^{2}\sigma_{y}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中，i称作选择强度（selection intensity），以表型标准差为单位，表示选择个体超过群体均值的程度。&lt;/p&gt;
&lt;p&gt;育种值的方差（&lt;span class=&#34;math inline&#34;&gt;\(var(\hat{a}_{i})\)&lt;/span&gt;）表示为:&lt;/p&gt;
&lt;p&gt;公式1.8&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
var(\hat{a}_{i}) = var(by) = var(h^{2}y) \\
= h^{4}\sigma^{2}_{y} \\
= r^{2}_{a,y}h^{2}\sigma^{2}_{y} \\
= r^{2}_{a,y}\sigma^{2}_{a}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;例1.1 一窝小母牛的一周岁体重均值为250kg，该性状的遗传力为0.45，如果其中一头小母牛周岁重320kg，请问它的育种值是多少？育种值估计的准确度是多少？&lt;/p&gt;
&lt;p&gt;根据公式1.4，育种值计算为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(\hat{a}_{i} = 0.45*(320-250) =\)&lt;/span&gt; 31.5kg。&lt;/p&gt;
&lt;p&gt;育种值估计的准确度(根据公式1.6计算)&lt;/p&gt;
&lt;p&gt;$r_{a,y} = $ 0.67。&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;1.3.2 重复记录&lt;/h3&gt;
&lt;p&gt;个体的多次测定记录，如奶牛在哺乳期的多次产奶量，其均值可以用来预测个体的育种值。对于个体的多次测定记录，通常会存在如下假定：由于受到环境因子或者永久影响个体多次测定记录的环境的影响，多次测定记录间会存在更多的相似性（additional resemblance）。换句话说（in other words），受非遗传永久环境效应的影响，个体的多次测定记录间存在额外的协方差。&lt;/p&gt;
&lt;p&gt;个体间的方差可以进一步剖分为部分遗传的和部分环境的方差（永久环境效应，permanent environmental effect）；个体内的方差组分，是由对个体进行多次测量时的临时环境差异引起的。因此，观测值的方差可以进一步剖分为：&lt;/p&gt;
&lt;p&gt;公式1.9&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[var(y) = var(g) + var(pe) + var(te)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;span class=&#34;math inline&#34;&gt;\(var(g)\)&lt;/span&gt;是加性和非加性遗传方差；&lt;span class=&#34;math inline&#34;&gt;\(var(pe)\)&lt;/span&gt;是由永久环境效应产生的方差；&lt;span class=&#34;math inline&#34;&gt;\(var(te)\)&lt;/span&gt;是由随机的(random) 临时的 (temporary) 环境效应引起的方差。&lt;/p&gt;
&lt;p&gt;组内相关（&lt;strong&gt;组内个体间的相关&lt;/strong&gt;），指的是个体间方差与表型方差的比例(the ratio of between-individual variance to phenotypic variance)&lt;/p&gt;
&lt;p&gt;公式1.10&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[t=(var(g)+var(pe))/var(y)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;t通常称之为重复力，用来测量个体记录间的相关。&lt;/p&gt;
&lt;p&gt;从公式1.10也可以反推出&lt;/p&gt;
&lt;p&gt;公式1.11&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[var(te)/var(y) = 1-t\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;对于公式1.10 ，通常会假设重复记录是来自同一个性状，也就是说任何成对记录间的遗传相关应该是1（&lt;strong&gt;不是太理解&lt;/strong&gt;）。另外一个假设是：所有的测定记录，具有相同的方差。并且所有成对记录的环境相关是相同的。设定&lt;span class=&#34;math inline&#34;&gt;\(\tilde{y}\)&lt;/span&gt;表示个体i的n个记录的均值。个体i的育种值可以通过公式1.12进行预测：&lt;/p&gt;
&lt;p&gt;公式1.12&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[\hat{a}_{i} = b(\tilde{y}_{i}-\mu)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;对上述公式进行推导：&lt;/p&gt;
&lt;p&gt;公式1.13&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[b = cov(a,\tilde{y})/var(\tilde{y})\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;体重a指的是真实育种值。进一步分解&lt;span class=&#34;math inline&#34;&gt;\(cov(a,\tilde{y})\)&lt;/span&gt;:&lt;/p&gt;
&lt;p&gt;公式1.14&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[cov(a,\tilde{y}) = cov(a,g + pe + \sum{te}/n) = \sigma^{2}_{a}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;之所以能够推导出上述公式，是因为a与pe、te之间不存在相关性，所以他们的协方差为零。&lt;/p&gt;
&lt;p&gt;公式1.15&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[var(\tilde{y}) = var(g) + var(pe) +var(te)/n\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;对于&lt;span class=&#34;math inline&#34;&gt;\(var(\tilde{y})\)&lt;/span&gt;，不同于&lt;span class=&#34;math inline&#34;&gt;\(var(y)\)&lt;/span&gt;,最后te的方差需要除以n。&lt;/p&gt;
&lt;p&gt;根据公式1.10 和公式1.11可以对公式1.15进一步变换：&lt;/p&gt;
&lt;p&gt;公式1.16（注意，原书中这个地方写错了，写成var(t)了）&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
var(\tilde{y}) = var(g) + var(pe) + (1-t)\frac{var(y)}{n} \\
= var(y)t + (1-t)\frac{var(y)}{n} \\
=var(y)(t + \frac{1-t}{n}) \\
=\sigma^{2}_{y}(t + \frac{1-t}{n})
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;根据公式1.16，那么公式1.13可以进一步简化为：&lt;/p&gt;
&lt;p&gt;公式1.17&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
b = cov(a,\tilde{y})/var(\tilde{y}) \\
= \frac{\sigma^{2}_{a}}{\sigma^{2}_{y}(t + \frac{1-t}{n})} \\
= \frac{\sigma^{2}_{a}}{\sigma^{2}_{y}}\frac{1}{t + \frac{1-t}{n}} \\
= h^{2}\frac{1}{\frac{nt+1-t}{n}} \\
= h^{2}\frac{1}{\frac{1+(n-1)t}{n}} \\
= h^{2}n\frac{1}{1+(n-1)t} \\
= \frac{nh^{2}}{1+(n-1)t} \\
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;公式可以看出b由&lt;strong&gt;遗传力、重复力和记录的重复测量次数&lt;/strong&gt;决定。从公式1.12中，可以推出，也意味着育种值由上述三个参数决定。&lt;/p&gt;
&lt;p&gt;就像前边提到的，假定个体重复记录的差别是由于测量连续性能（successive performance）时的现场环境差异（temporary environment）造成的。如果清楚那些影响性能的因子，会对连续记录产生影响，那么必须要进行校正。&lt;/p&gt;
&lt;p&gt;譬如，第一次和第二次哺乳期（lactation）产仔（calving）时的母牛年龄，会影响两次哺乳期的产奶量 （milk yield）。因此应用两次哺乳期产奶量均值，预测育种值时，必须要对这种年龄差异进行矫正。&lt;/p&gt;
&lt;p&gt;育种值的准确性用公式（1.18）表述为：&lt;/p&gt;
&lt;p&gt;公式1.18 （基于公式1.16和1.17）&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
r_{a,\tilde{y}} = \frac{cov(a,\tilde{y})}{\sigma_{a}\sigma_{\tilde{y}}} \\
= \frac{\sigma^{2}_{a}}{\sigma_{a}\sqrt{\sigma^{2}_{y}(t + \frac{1-t}{n})}} \\
= \frac{\sigma_{a}}{\sqrt{\sigma^{2}_{y}(t + \frac{1-t}{n})}} \\
= \frac{\sigma_{a}}{\sigma_{y}\sqrt{t + \frac{1-t}{n}}} \\
= \frac{h}{\sqrt{t + \frac{1-t}{n}}} \\
= h\sqrt{\frac{n}{nt +1-t}} \\
= \sqrt{\frac{nh^{2}}{1+(n-1)t}} \\
= \sqrt{b}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;与单性状的记录相比，多次记录其育种值估计的准确度更好，受重复力和测定记录次数影响。育种值预测准确度的提高，主要来自于当测定记录次数增加时，测定时环境方差（个体内方差）的降低。从公示1.16就可以看出。当n不断增大时，&lt;span class=&#34;math inline&#34;&gt;\(\sigma^{2}_{y}(t + \frac{1-t}{n})\)&lt;/span&gt;是不断减小的。当重复力较低时，增加测定记录次数，可以显著的提高预测准确度。&lt;/p&gt;
&lt;p&gt;譬如假定&lt;span class=&#34;math inline&#34;&gt;\(h^{2}\)&lt;/span&gt;=0.3, t=0.5，当n=1, 2, 6, 10时，育种值估计的准确度分别为&lt;/p&gt;
&lt;p&gt;n=1&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
r_{a,\tilde{y}} = \sqrt{\frac{nh^{2}}{1+(n-1)t}} \\
= \sqrt{\frac{1*0.3}{1+(1-1)*0.5}} \\
= 0.55
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;结果等同于单次记录结果。&lt;/p&gt;
&lt;p&gt;n=2&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
r_{a,\tilde{y}} = \sqrt{\frac{nh^{2}}{1+(n-1)t}} \\
= \sqrt{\frac{2*0.3}{1+(2-1)*0.5}} \\
= 0.63
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;n=6&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
r_{a,\tilde{y}} = \sqrt{\frac{nh^{2}}{1+(n-1)t}} \\
= \sqrt{\frac{6*0.3}{1+(6-1)*0.5}} \\
= 0.72
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;n=10&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
r_{a,\tilde{y}} = \sqrt{\frac{nh^{2}}{1+(n-1)t}} \\
= \sqrt{\frac{10*0.3}{1+(10-1)*0.5}} \\
= 0.74
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;当重复力比较高时，多次跟单次测量的准确度并无太大差别。这个其实是很朴素的道理，当重复力低时，也就是表示受环境影响较大，需要多次测量才会更加准确，但是当重复力比较高时，测量一次和多次的结果是一致的。&lt;/p&gt;
&lt;p&gt;如果重复力不同，那么基于不同重复力的育种值预测准确度结果，是没有可比性的。譬如如果t=1，那么无论n是多少，其育种值预测准确度都是h。但是如果t小于1，那么预测准确会大于h，但是不同重复率之间，应该是不可以比较的。&lt;/p&gt;
&lt;p&gt;例子1.2&lt;/p&gt;
&lt;p&gt;母牛第一次和第二次哺乳期的平均产奶总体均值是6000kg。一头母牛第一次和第二次哺乳期的平均产奶量是8000kg。产奶量的表型方差和遗传力是600kg和0.3，两次哺乳期产奶量的相关系数是0.5（重复力），预测育种值及其准确度。&lt;/p&gt;
&lt;p&gt;根据公式1.12&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
\hat{a}_{1} = b(\tilde{y}_{i}-\mu) \\
=b(8000-6000) \\
=2000b
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其中b根据公式1.17计算&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
b = \frac{nh^{2}}{1+(n-1)t} \\
= \frac{2*0.3}{1+(2-1)*0.5} \\
= 0.4
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;这头奶牛的育种值为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
\hat{a}_{1} = b(\tilde{y}_{i}-\mu) \\
=0.4*(8000-6000) \\
=2000*0.4 \\
=800 kg
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;育种值估计的准确度为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[r_{a,\tilde{y}} = \sqrt{b} = \sqrt{0.4} = 0.632\]&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
